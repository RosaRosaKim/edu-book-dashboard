<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>êµìœ¡Â·ë„ì„œë¹„ ì§€ì› í˜„í™©</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<style>
:root{
  --bg:#0d0f14;--surface:#141720;--surface2:#1c2030;--border:#252a3a;
  --accent:#4f8cff;--accent2:#a78bfa;--edu:#34d399;--book:#fb923c;
  --warn:#f59e0b;--danger:#f87171;--pend:#60a5fa;
  --text:#e2e8f0;--text2:#94a3b8;--text3:#64748b;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Noto Sans KR',sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(79,140,255,.03) 1px,transparent 1px),linear-gradient(90deg,rgba(79,140,255,.03) 1px,transparent 1px);background-size:40px 40px;pointer-events:none;z-index:0}
.wrap{max-width:1200px;margin:0 auto;padding:0 24px;position:relative;z-index:1}

/* â”€â”€ HEADER â”€â”€ */
header{border-bottom:1px solid var(--border);padding:16px 0;position:sticky;top:0;background:rgba(13,15,20,.93);backdrop-filter:blur(16px);z-index:100}
.hdr{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
.logo{display:flex;align-items:center;gap:10px}
.logo-icon{width:34px;height:34px;background:linear-gradient(135deg,var(--accent),var(--accent2));border-radius:9px;display:grid;place-items:center;font-size:17px;flex-shrink:0}
.logo-text{font-size:15px;font-weight:700;line-height:1.2}
.logo-sub{font-size:11px;color:var(--text3)}
.hdr-r{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.ychip{display:flex;align-items:center;gap:5px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:5px 10px}
.ychip label{font-size:10px;color:var(--text3)}
.ychip select{background:transparent;border:none;color:var(--text);font-family:'IBM Plex Mono',monospace;font-size:13px;font-weight:600;cursor:pointer;outline:none}
.ychip option{background:var(--surface2)}
.vtabs{display:flex;background:var(--surface2);border:1px solid var(--border);border-radius:9px;padding:3px;gap:2px}
.vtab{padding:5px 14px;border-radius:7px;font-size:12px;font-weight:600;cursor:pointer;border:none;background:transparent;color:var(--text3);font-family:'Noto Sans KR',sans-serif;transition:all .15s}
.vtab.on{background:var(--surface);color:var(--text);box-shadow:0 1px 5px rgba(0,0,0,.4)}

/* â”€â”€ BUTTONS â”€â”€ */
.btn{padding:7px 13px;border-radius:7px;font-size:12px;font-weight:600;cursor:pointer;border:none;font-family:'Noto Sans KR',sans-serif;transition:all .15s}
.bp{background:var(--accent);color:#fff}.bp:hover{filter:brightness(1.15);transform:translateY(-1px)}
.bo{background:transparent;border:1px solid var(--border);color:var(--text2)}.bo:hover{border-color:var(--accent);color:var(--accent)}
.bg{background:transparent;border:1px solid rgba(52,211,153,.3);color:var(--edu)}.bg:hover{background:rgba(52,211,153,.08)}

main{padding:26px 0 60px}

/* â”€â”€ êµ¬ê¸€ì‹œíŠ¸ íŒ¨ë„ â”€â”€ */
.gsp{background:linear-gradient(135deg,rgba(79,140,255,.06),rgba(167,139,250,.06));border:1px solid rgba(79,140,255,.18);border-radius:14px;padding:18px 22px;margin-bottom:20px}
.gsp-hdr{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;margin-bottom:14px}
.gsp-title{font-size:13px;font-weight:700;display:flex;align-items:center;gap:7px;color:var(--text)}
.cstat{display:flex;align-items:center;gap:6px;font-size:11px;color:var(--text3)}
.cdot{width:7px;height:7px;border-radius:50%;background:var(--text3);flex-shrink:0}
.cdot.ok{background:var(--edu);box-shadow:0 0 6px var(--edu)}
.cdot.spin{background:var(--warn);animation:pulse 1s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}

.gsp-fields{display:flex;gap:10px;flex-wrap:wrap;align-items:flex-end}
.gsp-f{flex:1;min-width:220px}
.flbl{font-size:10px;font-weight:700;color:var(--text3);letter-spacing:.6px;text-transform:uppercase;margin-bottom:5px}
.finp{width:100%;background:rgba(13,15,20,.7);border:1px solid var(--border);border-radius:8px;padding:8px 12px;color:var(--text);font-size:12px;font-family:'IBM Plex Mono',monospace;outline:none;transition:border-color .2s}
.finp:focus{border-color:var(--accent)}
.finp::placeholder{color:var(--text3);font-family:'Noto Sans KR',sans-serif;font-size:11px}
.gsp-btns{display:flex;gap:7px;flex-shrink:0;flex-wrap:wrap}

.howto{background:rgba(13,15,20,.6);border:1px solid var(--border);border-radius:10px;padding:13px 16px;margin-top:13px;font-size:12px;line-height:2;color:var(--text2)}
.howto b{color:var(--accent)}
.snum{display:inline-flex;align-items:center;justify-content:center;width:17px;height:17px;border-radius:50%;background:var(--accent);color:#fff;font-size:10px;font-weight:700;margin-right:3px}

/* â”€â”€ ì ì • í¬í•¨ ì•ˆë‚´ ë°°ë„ˆ â”€â”€ */
.pend-banner{display:flex;align-items:center;gap:10px;background:rgba(96,165,250,.07);border:1px solid rgba(96,165,250,.2);border-radius:10px;padding:10px 14px;margin-bottom:18px;font-size:12px;color:var(--pend)}
.pend-banner svg{flex-shrink:0}

/* â”€â”€ ì„¹ì…˜ íƒ€ì´í‹€ â”€â”€ */
.stitle{font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--text3);margin-bottom:10px}

/* â”€â”€ ìš”ì•½ ì¹´ë“œ â”€â”€ */
.sgrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px;margin-bottom:20px}
.sc{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:16px 18px;position:relative;overflow:hidden;transition:border-color .2s}
.sc:hover{border-color:rgba(79,140,255,.28)}
.sc::after{content:'';position:absolute;top:-8px;right:-8px;width:44px;height:44px;border-radius:50%;filter:blur(16px);opacity:.14}
.c0::after{background:var(--accent)}.c1::after{background:var(--edu)}.c2::after{background:var(--book)}.c3::after{background:var(--pend)}.c4::after{background:var(--accent2)}.c5::after{background:var(--danger)}
.sc-lbl{font-size:10px;color:var(--text3);font-weight:600;margin-bottom:5px;letter-spacing:.2px}
.sc-num{font-family:'IBM Plex Mono',monospace;font-size:19px;font-weight:600;letter-spacing:-1px;line-height:1.1}
.sc-sub{font-size:11px;color:var(--text3);margin-top:4px}
.sc-bar{height:2px;background:var(--surface2);border-radius:2px;margin-top:10px;overflow:hidden}
.sc-bfill{height:100%;border-radius:2px;transition:width .8s}

/* â”€â”€ í‰ê·  ì‚¬ìš©ë¥  ë°” â”€â”€ */
.avgcard{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:16px 20px;margin-bottom:20px}
.avgcard-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.avgcard-title{font-size:12px;color:var(--text2)}
.avgcard-pct{font-family:'IBM Plex Mono',monospace;font-size:20px;font-weight:600;color:var(--accent)}
/* 2ë‹¨ ë°”: ì™„ë£Œ(íŒŒë‘/ì´ˆë¡) + ì§„í–‰(ì ì„ ) */
.dualbar{height:10px;background:var(--surface2);border-radius:6px;overflow:hidden;margin-bottom:8px;position:relative}
.dualbar-done{height:100%;border-radius:6px 0 0 6px;background:linear-gradient(90deg,var(--accent),var(--edu));transition:width .8s}
.dualbar-pend{height:100%;position:absolute;top:0;border-radius:0 6px 6px 0;background:repeating-linear-gradient(90deg,var(--pend) 0,var(--pend) 4px,transparent 4px,transparent 8px);opacity:.6;transition:all .8s}
.leg{display:flex;gap:14px;flex-wrap:wrap}
.leg-item{display:flex;align-items:center;gap:5px;font-size:11px;color:var(--text3)}
.leg-dot{width:9px;height:9px;border-radius:2px}
.leg-dot.pend{background:repeating-linear-gradient(90deg,var(--pend) 0,var(--pend) 3px,transparent 3px,transparent 6px)}

/* â”€â”€ í•„í„°ë°” â”€â”€ */
.fbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-bottom:10px}
.sinp{flex:1;min-width:170px;background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:7px 12px;color:var(--text);font-size:13px;font-family:'Noto Sans KR',sans-serif;outline:none}
.sinp:focus{border-color:var(--accent)}
.sinp::placeholder{color:var(--text3)}
.fsel{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:7px 10px;color:var(--text2);font-size:12px;font-family:'Noto Sans KR',sans-serif;outline:none;cursor:pointer}
.fsel option{background:var(--surface2)}

/* â”€â”€ í…Œì´ë¸” â”€â”€ */
.twrap{background:var(--surface);border:1px solid var(--border);border-radius:14px;overflow:hidden;margin-bottom:20px}
table{width:100%;border-collapse:collapse}
thead tr{background:var(--surface2);border-bottom:1px solid var(--border)}
th{padding:10px 13px;text-align:left;font-size:10px;font-weight:700;letter-spacing:.5px;color:var(--text3);text-transform:uppercase;white-space:nowrap}
tbody tr{border-bottom:1px solid rgba(37,42,58,.8);transition:background .12s;cursor:default}
tbody tr:last-child{border-bottom:none}
tbody tr:hover{background:rgba(79,140,255,.04)}
td{padding:11px 13px;font-size:13px;vertical-align:middle}

/* ì´ë¦„ ì»¬ëŸ¼ */
.emp-name-cell .name{font-weight:500}
.emp-name-cell .dept{font-size:11px;color:var(--text3);margin-top:1px}

/* ê¸ˆì•¡ ìŠ¤íƒ (í™•ì •/ì ì •) */
.amt-stack .confirmed{font-family:'IBM Plex Mono',monospace;font-size:13px;font-weight:500}
.amt-stack .pending-amt{font-size:10px;color:var(--pend);margin-top:2px;font-family:'IBM Plex Mono',monospace}

/* í•œë„ ë°” */
.lbar-wrap{min-width:120px}
.lbar-labels{display:flex;justify-content:space-between;font-size:10px;color:var(--text3);margin-bottom:3px}
.lbar-labels .pct{color:var(--text);font-family:'IBM Plex Mono',monospace;font-weight:600}
.lbar-track{height:5px;background:var(--surface2);border-radius:3px;overflow:visible;position:relative}
.lbar-done{height:100%;border-radius:3px;background:linear-gradient(90deg,var(--accent),var(--edu));transition:width .6s}
.lbar-pend-stripe{position:absolute;top:0;height:100%;border-radius:0 3px 3px 0;background:repeating-linear-gradient(90deg,var(--pend) 0,var(--pend) 3px,transparent 3px,transparent 6px);opacity:.55;transition:all .6s}
.lbar-remain{font-size:10px;color:var(--text3);margin-top:3px}

/* ë±ƒì§€ */
.badge{display:inline-block;padding:2px 7px;border-radius:4px;font-size:10px;font-weight:600;white-space:nowrap}
.be{background:rgba(52,211,153,.1);color:var(--edu)}
.bb{background:rgba(251,146,60,.1);color:var(--book)}
.bbt{background:rgba(79,140,255,.1);color:var(--accent)}
.bn{background:rgba(100,116,139,.1);color:var(--text3)}

/* ìƒíƒœ pill */
.pill{display:inline-flex;align-items:center;gap:4px;padding:3px 9px;border-radius:20px;font-size:11px;font-weight:500;white-space:nowrap}
.pill::before{content:'';width:5px;height:5px;border-radius:50%}
.ps{background:rgba(52,211,153,.08);color:var(--edu)}.ps::before{background:var(--edu)}
.pw{background:rgba(245,158,11,.08);color:var(--warn)}.pw::before{background:var(--warn)}
.pf{background:rgba(248,113,113,.08);color:var(--danger)}.pf::before{background:var(--danger)}
.pp{background:rgba(96,165,250,.08);color:var(--pend)}.pp::before{background:var(--pend)}

/* ìƒì„¸ ë²„íŠ¼ */
.rbtn{background:none;border:1px solid var(--border);border-radius:5px;color:var(--text3);padding:3px 9px;font-size:11px;cursor:pointer;font-family:'Noto Sans KR',sans-serif;transition:all .12s;white-space:nowrap}
.rbtn:hover{border-color:var(--accent);color:var(--accent)}

.mono{font-family:'IBM Plex Mono',monospace;font-weight:500}
.nodata{text-align:center;padding:32px;color:var(--text3);font-size:13px}

/* â”€â”€ ìƒì„¸ ë·° â”€â”€ */
.backbtn{display:flex;align-items:center;gap:5px;font-size:13px;color:var(--text3);cursor:pointer;margin-bottom:20px;background:none;border:none;font-family:'Noto Sans KR',sans-serif;transition:color .15s}
.backbtn:hover{color:var(--text)}
.det-ehdr{display:flex;align-items:flex-start;gap:14px;margin-bottom:20px;flex-wrap:wrap}
.det-avatar{width:48px;height:48px;border-radius:12px;display:grid;place-items:center;font-size:18px;font-weight:700;flex-shrink:0}
.det-name{font-size:18px;font-weight:700}
.det-info{font-size:12px;color:var(--text3);margin-top:2px}

/* ê²Œì´ì§€ ì¹´ë“œ */
.gcard{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:18px 20px;margin-bottom:14px}
.gcard-top{display:flex;justify-content:space-between;align-items:flex-end;margin-bottom:12px;flex-wrap:wrap;gap:10px}
.gcard-main .lbl{font-size:10px;color:var(--text3);margin-bottom:3px}
.gcard-main .used{font-family:'IBM Plex Mono',monospace;font-size:26px;font-weight:600}
.gcard-main .used-sub{font-size:11px;color:var(--text3);margin-top:2px}
.gcard-right{text-align:right}
.gcard-right .rem-lbl{font-size:10px;color:var(--text3)}
.gcard-right .rem{font-family:'IBM Plex Mono',monospace;font-size:16px;font-weight:600;color:var(--text2)}
.gcard-right .lim{font-size:11px;color:var(--text3);margin-top:2px}
.bigtrack{height:12px;background:var(--surface2);border-radius:7px;overflow:visible;position:relative;margin-bottom:10px}
.bigdone{height:100%;border-radius:7px;background:linear-gradient(90deg,var(--accent),var(--edu));transition:width .8s}
.bigpend{position:absolute;top:0;height:100%;border-radius:0 7px 7px 0;background:repeating-linear-gradient(90deg,var(--pend) 0,var(--pend) 4px,transparent 4px,transparent 8px);opacity:.55;transition:all .8s}
.gcard-legend{display:flex;gap:12px;flex-wrap:wrap}
.gl-item{display:flex;align-items:center;gap:5px;font-size:11px;color:var(--text3)}
.gl-dot{width:9px;height:9px;border-radius:2px}

/* ì‹ ì²­ ë‚´ì—­ í…Œì´ë¸” */
.det-badge-pend{background:rgba(96,165,250,.1);color:var(--pend);font-size:10px;padding:1px 5px;border-radius:3px;font-weight:600}

/* â”€â”€ ì§ì› ì¡°íšŒ ë·° â”€â”€ */
.lkwrap{max-width:460px;margin:36px auto}
.lkcard{background:var(--surface);border:1px solid var(--border);border-radius:18px;padding:28px;text-align:center}
.lkresult{background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:17px;margin-top:14px;text-align:left;display:none}
.lkresult.show{display:block}

/* â”€â”€ ëª¨ë‹¬ â”€â”€ */
.ov{display:none;position:fixed;inset:0;background:rgba(0,0,0,.72);backdrop-filter:blur(5px);z-index:200;align-items:center;justify-content:center;padding:20px}
.ov.show{display:flex}
.modal{background:var(--surface);border:1px solid var(--border);border-radius:18px;width:100%;max-width:500px;padding:24px;position:relative;max-height:90vh;overflow-y:auto}
.modal-sm{max-width:390px}
.mtitle{font-size:16px;font-weight:700;margin-bottom:3px}
.msub{font-size:12px;color:var(--text3);margin-bottom:17px}
.fg{margin-bottom:12px}
.fl{display:block;font-size:10px;font-weight:700;color:var(--text3);margin-bottom:5px;text-transform:uppercase;letter-spacing:.5px}
.fi{width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:8px 12px;color:var(--text);font-size:13px;font-family:'Noto Sans KR',sans-serif;outline:none;transition:border-color .2s}
.fi:focus{border-color:var(--accent)}
.fi option{background:var(--surface2)}
.frow{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.mfooter{display:flex;gap:8px;margin-top:16px;justify-content:flex-end}
.cbtn{position:absolute;top:14px;right:14px;background:none;border:none;color:var(--text3);font-size:18px;cursor:pointer;line-height:1}
.cbtn:hover{color:var(--text)}
.xlcheck{display:flex;align-items:center;gap:8px;font-size:13px;cursor:pointer;padding:5px 0}
.xlcheck input{accent-color:var(--accent);width:14px;height:14px}

/* â”€â”€ í† ìŠ¤íŠ¸ â”€â”€ */
.toast{position:fixed;bottom:20px;right:20px;background:var(--surface);border:1px solid var(--edu);border-radius:10px;padding:11px 16px;font-size:13px;color:var(--text);box-shadow:0 8px 28px rgba(0,0,0,.35);transform:translateY(90px);opacity:0;transition:all .28s;z-index:300;pointer-events:none}
.toast.show{transform:translateY(0);opacity:1}

.fadein{animation:fi .35s ease}
@keyframes fi{from{opacity:0;transform:translateY(7px)}to{opacity:1;transform:translateY(0)}}

@media(max-width:768px){th,td{padding:9px 9px}.frow{grid-template-columns:1fr}.sgrid{grid-template-columns:repeat(2,1fr)}}
</style>
</head>
<body>

<header>
<div class="wrap hdr">
  <div class="logo">
    <div class="logo-icon">ğŸ“š</div>
    <div>
      <div class="logo-text">êµìœ¡Â·ë„ì„œë¹„ ì§€ì› í˜„í™©</div>
      <div class="logo-sub">ì—°ê°„ 50ë§Œì› í•œë„ Â· ë¹„ì¦ˆí”Œë ˆì´ ì—°ë™</div>
    </div>
  </div>
  <div class="hdr-r">
    <div class="ychip">
      <label>ì—°ë„</label>
      <select id="ySel" onchange="onYearChange()">
        <option value="2026">2026</option>
        <option value="2025">2025</option>
        <option value="2024">2024</option>
      </select>
    </div>
    <div class="vtabs">
      <button class="vtab on" id="empTab" onclick="switchView('emp')">ì§ì› ì¡°íšŒ</button>
      <button class="vtab" id="adminTab" style="display:none" onclick="switchView('admin')">ê´€ë¦¬ì</button>
    </div>
    <button class="btn bo" id="lockBtn" onclick="toggleAdmin()" style="font-size:11px;padding:5px 10px" title="ê´€ë¦¬ì ë¡œê·¸ì¸">ğŸ”’</button>
  </div>
</div>
</header>

<main>
<div class="wrap">

<!-- â•â•â•â•â•â•â•â•â•â• ê´€ë¦¬ì ë·° â•â•â•â•â•â•â•â•â•â• -->
<div id="adminView" class="fadein">

  <!-- êµ¬ê¸€ ì‹œíŠ¸ íŒ¨ë„ -->
  <div class="gsp">
    <div class="gsp-hdr">
      <div class="gsp-title">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2.2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
        êµ¬ê¸€ ì‹œíŠ¸ ì—°ë™
      </div>
      <div class="cstat">
        <div class="cdot" id="cdot"></div>
        <span id="ctext">ë¯¸ì—°ê²° (ìƒ˜í”Œ ë°ì´í„° í‘œì‹œ ì¤‘)</span>
      </div>
    </div>
    <div class="gsp-fields">
      <div class="gsp-f">
        <div class="flbl">êµìœ¡ ì‹ ì²­ì„œ ì‹œíŠ¸ URL</div>
        <input class="finp" id="eduUrl" value="https://docs.google.com/spreadsheets/d/e/2PACX-1vT_fB63Tzt0lv8EtnMDQUxO2ULaDwIZr6rNiYIOqnR8vTwoBx2mKy0ylMdA9A8L7fdgXULlCVs3uliU/pub?output=csv" />
      </div>
      <div class="gsp-f">
        <div class="flbl">ë„ì„œ ì‹ ì²­ì„œ ì‹œíŠ¸ URL</div>
        <input class="finp" id="bookUrl" value="https://docs.google.com/spreadsheets/d/e/2PACX-1vT_fB63Tzt0lv8EtnMDQUxO2ULaDwIZr6rNiYIOqnR8vTwoBx2mKy0ylMdA9A8L7fdgXULlCVs3uliU/pub?gid=367337092&single=true&output=csv" />
      </div>
      <div class="gsp-btns">
        <button class="btn bp" onclick="loadSheets()">ğŸ”„ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <button class="btn bo" onclick="openAdd()">+ ì§ì ‘ ì…ë ¥</button>
        <button class="btn bg" onclick="openXl()">ğŸ“¥ ì—‘ì…€ ì €ì¥</button>
      </div>
    </div>
    <div class="howto" id="howto">
      <b>ğŸ“‹ êµ¬ê¸€ ì‹œíŠ¸ â†’ ëŒ€ì‹œë³´ë“œ ì—°ë™ ë°©ë²•</b><br>
      <span class="snum">1</span>ë¹„ì¦ˆí”Œë ˆì´ì—ì„œ <b>ì—‘ì…€ ì €ì¥</b> â†’ ë³µí˜¸í™” â†’ êµ¬ê¸€ ì‹œíŠ¸ì— <b>ë¶™ì—¬ë„£ê¸°</b> (íƒ­: êµìœ¡ ì‹ ì²­ì„œ / ë„ì„œ ì‹ ì²­ì„œ ë¶„ë¦¬)<br>
      <span class="snum">2</span>êµ¬ê¸€ ì‹œíŠ¸ ë©”ë‰´ <b>íŒŒì¼ â†’ ê³µìœ  â†’ ì›¹ì— ê²Œì‹œ</b> í´ë¦­<br>
      <span class="snum">3</span>í•´ë‹¹ íƒ­ ì„ íƒ â†’ <b>CSV í˜•ì‹</b>ìœ¼ë¡œ ê²Œì‹œ â†’ ë§í¬ ë³µì‚¬<br>
      <span class="snum">4</span>ìœ„ URL ì…ë ¥ì°½ì— ë¶™ì—¬ë„£ê³  <b>ë¶ˆëŸ¬ì˜¤ê¸°</b> í´ë¦­ Â· ì´í›„ì—” ì‹œíŠ¸ ì—…ë°ì´íŠ¸ í›„ ë‹¤ì‹œ í´ë¦­ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤<br>
      <span style="font-size:11px;color:var(--text3)">â€» ì‹œíŠ¸ë¥¼ í•˜ë‚˜ë¡œ í†µí•© ìš´ì˜ ì‹œ í•œ ì¹¸ë§Œ ì…ë ¥í•´ë„ ë©ë‹ˆë‹¤</span>
    </div>
  </div>

  <!-- ì ì • í¬í•¨ ì•ˆë‚´ ë°°ë„ˆ -->
  <div class="pend-banner">
    <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
    í•©ê³„ ê¸°ì¤€: <b style="margin:0 2px">ì™„ë£Œ + ì§„í–‰ ì ì • í¬í•¨</b>, ë°˜ì†¡ì€ ì œì™¸í•©ë‹ˆë‹¤. ì§„í–‰ ì¤‘ ê¸ˆì•¡ì€ ì ì„ (<span style="font-family:'IBM Plex Mono',monospace;font-size:11px;border-bottom:2px dashed var(--pend);padding-bottom:1px">Â·Â·Â·</span>)ìœ¼ë¡œ êµ¬ë¶„ í‘œì‹œë©ë‹ˆë‹¤.
  </div>

  <!-- ìš”ì•½ ì¹´ë“œ -->
  <div class="stitle" id="sumTitle">ì—°ê°„ ì „ì²´ í˜„í™©</div>
  <div class="sgrid" id="sgrid"></div>

  <!-- í‰ê·  ì‚¬ìš©ë¥  -->
  <div class="avgcard">
    <div class="avgcard-hdr">
      <span class="avgcard-title">ì „ì²´ ì¸ì› í‰ê·  í•œë„ ì‚¬ìš©ë¥  Â· <b id="yLabel">2026ë…„</b></span>
      <span class="avgcard-pct" id="avgPct">0%</span>
    </div>
    <div class="dualbar" id="dualbar">
      <div class="dualbar-done" id="avgDone" style="width:0%"></div>
      <div class="dualbar-pend" id="avgPend" style="left:0%;width:0%"></div>
    </div>
    <div class="leg">
      <div class="leg-item"><div class="leg-dot" style="background:linear-gradient(90deg,var(--accent),var(--edu))"></div>í™•ì • (ì™„ë£Œ)</div>
      <div class="leg-item"><div class="leg-dot pend"></div>ì ì • (ì§„í–‰ ì¤‘)</div>
      <div class="leg-item"><div class="leg-dot" style="background:var(--surface2)"></div>ì”ì—¬</div>
    </div>
  </div>

  <!-- ì§ì› ëª©ë¡ -->
  <div id="listSec">
    <div class="stitle">ì§ì›ë³„ ì‚¬ìš© í˜„í™©</div>
    <div class="fbar">
      <input class="sinp" type="text" id="srch" placeholder="ğŸ”  ì´ë¦„ Â· ë¶€ì„œ Â· ì‚¬ì›ë²ˆí˜¸ ê²€ìƒ‰" oninput="renderTable()"/>
      <select class="fsel" id="tf" onchange="renderTable()">
        <option value="">ì „ì²´ ìœ í˜•</option>
        <option value="edu">êµìœ¡ë¹„</option>
        <option value="book">ë„ì„œë¹„</option>
      </select>
      <select class="fsel" id="sf" onchange="renderTable()">
        <option value="">ì „ì²´ ìƒíƒœ</option>
        <option value="safe">ì—¬ìœ </option>
        <option value="warn">ì£¼ì˜(80%â†‘)</option>
        <option value="full">í•œë„ ì†Œì§„</option>
        <option value="over">í•œë„ ì´ˆê³¼</option>
      </select>
    </div>
    <div class="twrap">
      <table>
        <thead><tr>
          <th>ì´ë¦„ / ë¶€ì„œ</th>
          <th>ì‚¬ì›ë²ˆí˜¸</th>
          <th>êµìœ¡ë¹„</th>
          <th>ë„ì„œë¹„</th>
          <th>ì ì • í•©ê³„</th>
          <th>í•œë„ ì‚¬ìš©ë¥ </th>
          <th>ìƒíƒœ</th>
          <th></th>
        </tr></thead>
        <tbody id="etbody"></tbody>
      </table>
    </div>
  </div>

  <!-- ì§ì› ìƒì„¸ -->
  <div id="detSec" style="display:none" class="fadein">
    <button class="backbtn" onclick="goBack()">â† ëª©ë¡ìœ¼ë¡œ</button>
    <div id="detContent"></div>
  </div>

</div><!-- /adminView -->

<!-- â•â•â•â•â•â•â•â•â•â• ì§ì› ì¡°íšŒ ë·° â•â•â•â•â•â•â•â•â•â• -->
<div id="empView" style="display:none" class="fadein">
  <div class="lkwrap">
    <div class="lkcard">
      <div style="font-size:34px;margin-bottom:11px">ğŸ”</div>
      <div style="font-size:17px;font-weight:700;margin-bottom:5px">ë‚´ êµìœ¡Â·ë„ì„œë¹„ ì¡°íšŒ</div>
      <div style="font-size:12px;color:var(--text3);margin-bottom:10px">ì´ë¦„ìœ¼ë¡œ ì˜¬í•´ ì‚¬ìš© í˜„í™©ì„ í™•ì¸í•˜ì„¸ìš”</div>
      <div style="display:flex;align-items:center;gap:6px;background:rgba(96,165,250,.07);border:1px solid rgba(96,165,250,.18);border-radius:8px;padding:8px 12px;margin-bottom:17px;font-size:11px;color:var(--pend);text-align:left">
        <span style="font-size:14px">ğŸ“…</span>
        <span>ë‹´ë‹¹ìê°€ <b>ë§¤ì£¼ ì›”ìš”ì¼ ì˜¤ì „</b>ì— ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.<br><span style="color:var(--text3)">ìµœì‹  ê²°ì¬ ë‚´ì—­ì€ ë‹¤ìŒ ì—…ë°ì´íŠ¸ í›„ ë°˜ì˜ë©ë‹ˆë‹¤.</span></span>
      </div>
      <input class="fi" id="lkName" placeholder="ì´ë¦„ ì…ë ¥ (ì˜ˆ: í™ê¸¸ë™)" style="margin-bottom:8px"/>
      <select class="fi" id="lkDept" style="margin-bottom:13px">
        <option value="">ë¶€ì„œ ì„ íƒ (ë™ëª…ì´ì¸ êµ¬ë¶„, ì„ íƒì‚¬í•­)</option>
      </select>
      <button class="btn bp" style="width:100%;padding:10px 0" onclick="doLookup()">ì¡°íšŒí•˜ê¸°</button>
      <div id="lkResult"></div>
    </div>
  </div>
</div>

</div><!-- /wrap -->
</main>

<!-- â”€â”€ ì§ì ‘ ì…ë ¥ ëª¨ë‹¬ â”€â”€ -->
<div class="ov" id="addMod">
  <div class="modal">
    <button class="cbtn" onclick="closeM('addMod')">âœ•</button>
    <div class="mtitle">ì‹ ì²­ ë‚´ì—­ ì§ì ‘ ì…ë ¥</div>
    <div class="msub">êµ¬ê¸€ ì‹œíŠ¸ ì—°ë™ ì „, ìˆ˜ë™ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.</div>
    <div class="frow">
      <div class="fg"><label class="fl">ì´ë¦„</label><input class="fi" id="fn" placeholder="í™ê¸¸ë™"/></div>
      <div class="fg"><label class="fl">ë¶€ì„œ</label><input class="fi" id="fd" placeholder="ê°œë°œíŒ€"/></div>
    </div>
    <div class="fg"><label class="fl">ì‚¬ì›ë²ˆí˜¸</label><input class="fi" id="fe" placeholder="EM321400"/></div>
    <div class="frow">
      <div class="fg"><label class="fl">ìœ í˜•</label>
        <select class="fi" id="ftype"><option value="edu">ğŸ“– êµìœ¡ ì‹ ì²­ì„œ</option><option value="book">ğŸ“š ë„ì„œ ì‹ ì²­ì„œ</option></select>
      </div>
      <div class="fg"><label class="fl">ë¹„ìš© (ì›)</label><input class="fi" id="famt" type="number" placeholder="150000"/></div>
    </div>
    <div class="fg"><label class="fl">ê³¼ì •ëª… / ë„ì„œëª…</label><input class="fi" id="ftitle" placeholder="AWS ê°œë°œì ê³¼ì • / í´ë¦° ì½”ë“œ"/></div>
    <div class="frow">
      <div class="fg"><label class="fl">ê¸°ì•ˆì¼</label><input class="fi" id="fdate" type="date"/></div>
      <div class="fg"><label class="fl">ê²°ì¬ ìƒíƒœ</label>
        <select class="fi" id="fst">
          <option value="ì™„ë£Œ">âœ… ì™„ë£Œ</option>
          <option value="ì§„í–‰">â³ ì§„í–‰ ì¤‘</option>
          <option value="ë°˜ì†¡">âŒ ë°˜ì†¡</option>
        </select>
      </div>
    </div>
    <div class="mfooter">
      <button class="btn bo" onclick="closeM('addMod')">ì·¨ì†Œ</button>
      <button class="btn bp" onclick="addRecord()">ì¶”ê°€</button>
    </div>
  </div>
</div>

<!-- â”€â”€ ì—‘ì…€ ì €ì¥ ëª¨ë‹¬ â”€â”€ -->
<div class="ov" id="xlMod">
  <div class="modal modal-sm">
    <button class="cbtn" onclick="closeM('xlMod')">âœ•</button>
    <div class="mtitle">ğŸ“¥ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</div>
    <div class="msub">í¬í•¨í•  ì‹œíŠ¸ì™€ ê¸°ì¤€ì„ ì„ íƒí•˜ì„¸ìš”.</div>
    <div class="fg"><label class="fl">ëŒ€ìƒ ì—°ë„</label>
      <select class="fi" id="xly"><option value="2026">2026ë…„</option><option value="2025">2025ë…„</option><option value="all">ì „ì²´</option></select>
    </div>
    <div class="fg"><label class="fl">í¬í•¨í•  ì‹œíŠ¸</label>
      <label class="xlcheck"><input type="checkbox" id="xs1" checked> ì§ì›ë³„ ìš”ì•½ í˜„í™©</label>
      <label class="xlcheck"><input type="checkbox" id="xs2" checked> ì‹ ì²­ ë‚´ì—­ ìƒì„¸</label>
      <label class="xlcheck"><input type="checkbox" id="xs3" checked> ì”ì—¬ í•œë„ í˜„í™©</label>
    </div>
    <div class="fg"><label class="fl">ìœ í˜•</label>
      <select class="fi" id="xlt"><option value="all">ì „ì²´</option><option value="edu">êµìœ¡ë¹„ë§Œ</option><option value="book">ë„ì„œë¹„ë§Œ</option></select>
    </div>
    <div class="fg"><label class="fl">ì§„í–‰ ì¤‘ í¬í•¨ ê¸°ì¤€</label>
      <select class="fi" id="xlp">
        <option value="both">ì™„ë£Œ+ì§„í–‰ ì ì • í•©ê³„ë¡œ ì¶œë ¥</option>
        <option value="done">ì™„ë£Œë§Œ (í™•ì •ì•¡)</option>
      </select>
    </div>
    <div class="mfooter">
      <button class="btn bo" onclick="closeM('xlMod')">ì·¨ì†Œ</button>
      <button class="btn bg" onclick="doExcel()">ğŸ“¥ ë‹¤ìš´ë¡œë“œ</button>
    </div>
  </div>
</div>

<!-- â”€â”€ ê´€ë¦¬ì ë¡œê·¸ì¸ ëª¨ë‹¬ â”€â”€ -->
<div class="ov" id="adminLoginMod">
  <div class="modal modal-sm">
    <button class="cbtn" onclick="closeM('adminLoginMod')">âœ•</button>
    <div class="mtitle">ğŸ”’ ê´€ë¦¬ì ë¡œê·¸ì¸</div>
    <div class="msub">ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</div>
    <div class="fg">
      <input class="fi" id="adminPw" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸"
        onkeydown="if(event.key==='Enter')checkAdmin()"/>
    </div>
    <div id="adminPwErr" style="font-size:12px;color:var(--danger);margin-top:6px;display:none">ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.</div>
    <div class="mfooter">
      <button class="btn bo" onclick="closeM('adminLoginMod')">ì·¨ì†Œ</button>
      <button class="btn bp" onclick="checkAdmin()">í™•ì¸</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ìƒìˆ˜ & ì „ì—­ ìƒíƒœ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const LIMIT = 500000;
let curYear = 2026;
let records = [];   // ì‹¤ì œ ë¡œë“œëœ ë°ì´í„°
let uid = 1;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ìƒ˜í”Œ ë°ì´í„° (êµ¬ê¸€ì‹œíŠ¸ ì—°ë™ ì „ ë¯¸ë¦¬ë³´ê¸°ìš©)
// ì‹¤ì œ ì‹œíŠ¸ì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„° ê¸°ë°˜
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SAMPLE = [
  // â–¼ êµìœ¡ ì‹ ì²­ì„œ (ì‹¤ì œ ì‹œíŠ¸ ë°ì´í„°)
  {id:1,name:'ë°±ì†Œì˜',empno:'EM3510042',dept:'Technicalì»¨ì„¤íŒ…ê·¸ë£¹',type:'edu',amount:319000,title:'ChatGPT Plus 11ê°œì›” êµ¬ë…',date:'2026-02-20',status:'ì§„í–‰',year:2026},
  {id:2,name:'ì´ë™ì˜',empno:'EM3213012',dept:'DevOpsê·¸ë£¹',type:'edu',amount:32461,title:'chat gpt',date:'2026-02-19',status:'ì§„í–‰',year:2026},
  {id:3,name:'ì—°ì£¼í¬',empno:'EM3214002',dept:'CXí’ˆì§ˆê²€ì¦íŒŒíŠ¸',type:'edu',amount:32058,title:'Chat gpt',date:'2026-02-19',status:'ì™„ë£Œ',year:2026},
  {id:4,name:'ê¹€íš¨ì§„',empno:'EM3216001',dept:'AIì—°êµ¬1íŒŒíŠ¸',type:'edu',amount:160259,title:'í´ë¡œë“œ ì½”ë“œ',date:'2026-02-19',status:'ì™„ë£Œ',year:2026},
  {id:5,name:'ê¹€ìˆ˜í˜„',empno:'EM3515002',dept:'SVC 2íŒŒíŠ¸',type:'edu',amount:145000,title:'ChatGPT',date:'2026-02-19',status:'ì™„ë£Œ',year:2026},
  {id:6,name:'ë…¸ì„±ì€',empno:'EM3410009',dept:'í”„ë¡œì íŠ¸íŒŒíŠ¸',type:'edu',amount:33275,title:'chatGPT',date:'2026-02-19',status:'ì™„ë£Œ',year:2026},
  {id:7,name:'ê¹€íƒœí›ˆ',empno:'EM3223012',dept:'MFG 1íŒŒíŠ¸',type:'edu',amount:32000,title:'Claude Pro',date:'2026-02-19',status:'ì™„ë£Œ',year:2026},
  {id:8,name:'ê¹€ì§€ì€',empno:'EM3223011',dept:'DS 1íŒŒíŠ¸',type:'edu',amount:319000,title:'Gemini',date:'2026-02-19',status:'ì§„í–‰',year:2026},
  {id:9,name:'ì „í•˜ì˜',empno:'EM3510015',dept:'Cloudìš´ì˜íŒŒíŠ¸',type:'edu',amount:32483,title:'Claude',date:'2026-02-19',status:'ì™„ë£Œ',year:2026},
  {id:10,name:'ê¹€í˜„ì˜',empno:'EM3223013',dept:'ê¸°ë°˜ê¸°ìˆ ê°œë°œíŒŒíŠ¸',type:'edu',amount:32263,title:'claude Pro',date:'2026-02-13',status:'ì™„ë£Œ',year:2026},
  {id:11,name:'ë‚¨ì´ë‘',empno:'EM3410008',dept:'Cloudìš´ì˜íŒŒíŠ¸',type:'edu',amount:31744,title:'Claude AI',date:'2026-02-13',status:'ì™„ë£Œ',year:2026},
  {id:12,name:'í•˜ì°½ë¹ˆ',empno:'EM3119001',dept:'AIì—°êµ¬1íŒŒíŠ¸',type:'edu',amount:134884,title:'Claude',date:'2026-02-13',status:'ë°˜ì†¡',year:2026},
  {id:13,name:'ì‹ ì‚°í•˜',empno:'EM3515004',dept:'E&I 4íŒŒíŠ¸',type:'edu',amount:29000,title:'chatGPT Pro 1ê°œì›” êµ¬ë…',date:'2026-02-13',status:'ì™„ë£Œ',year:2026},
  {id:14,name:'ê¹€ì •ì¸',empno:'EM3510005',dept:'MFG 1íŒŒíŠ¸',type:'edu',amount:58000,title:'ChatGPT - GPT5.3 Codex',date:'2026-02-13',status:'ì™„ë£Œ',year:2026},
  {id:15,name:'ì¶”ìš©í˜¸',empno:'EM3419002',dept:'P&C 4íŒŒíŠ¸',type:'edu',amount:32000,title:'Claude Pro',date:'2026-02-13',status:'ì™„ë£Œ',year:2026},
  {id:16,name:'ìœ¡í˜„ì§„',empno:'EM3113008',dept:'DevOpsê·¸ë£¹',type:'edu',amount:116000,title:'chat gpt pro 1ê°œì›” x4',date:'2026-02-13',status:'ì™„ë£Œ',year:2026},
  {id:17,name:'ì´ë™ìœ¨',empno:'EM3618001',dept:'ì˜ì—…ê¸°íšê·¸ë£¹',type:'edu',amount:29000,title:'Google Gemini',date:'2026-02-13',status:'ì™„ë£Œ',year:2026},
  {id:18,name:'ê¶Œì¢…í˜',empno:'EM2110001',dept:'P&CíŒ€',type:'edu',amount:150000,title:'Claude (vibe coding)',date:'2026-02-12',status:'ì™„ë£Œ',year:2026},
  {id:19,name:'ì´í˜„ì¤€',empno:'EM3616012',dept:'ValueUpê·¸ë£¹',type:'edu',amount:290000,title:'Google AI Pro',date:'2026-02-12',status:'ì™„ë£Œ',year:2026},
  {id:20,name:'ë¬¸íƒœí˜¸',empno:'EM3515003',dept:'E&I 3íŒŒíŠ¸',type:'edu',amount:323400,title:'Claude Pro 1ë…„',date:'2026-02-12',status:'ì™„ë£Œ',year:2026},
  {id:21,name:'ë¬¸ì‚¬ë¼',empno:'EM3310001',dept:'ê¸€ë¡œë²Œì‚¬ì—…ê¸°íšê·¸ë£¹',type:'edu',amount:32582,title:'ChatGPT',date:'2026-02-12',status:'ì™„ë£Œ',year:2026},
  {id:22,name:'ì´íƒœì›',empno:'EM3623006',dept:'ì†”ë£¨ì…˜ì˜ì—…1ê·¸ë£¹',type:'edu',amount:156000,title:'ChatGPT GO êµ¬ë…',date:'2026-02-12',status:'ì™„ë£Œ',year:2026},
  {id:23,name:'ì˜¤ì •ì‹',empno:'EM2712004',dept:'ì†”ë£¨ì…˜í’ˆì§ˆê·¸ë£¹',type:'edu',amount:34000,title:'Cursor Pro (ì¶”ê°€ í† í°)',date:'2026-02-12',status:'ì™„ë£Œ',year:2026},
  {id:24,name:'ì„±ìŠ¹ì—´',empno:'EM3510001',dept:'D2Sê·¸ë£¹',type:'edu',amount:323620,title:'claude ì—°ê°„',date:'2026-02-11',status:'ì™„ë£Œ',year:2026},
  {id:25,name:'ì´ì°½í•œ',empno:'EM3410006',dept:'P2PíŒŒíŠ¸',type:'edu',amount:24000,title:'ë°”ì´ë¸Œ ì½”ë”© 1ì¸ ì°½ì—… ë¶€íŠ¸ìº í”„',date:'2026-02-10',status:'ì™„ë£Œ',year:2026},
  {id:26,name:'ë°©ëŒ€í˜',empno:'EM2010001',dept:'ê¸°ìˆ Â·í”„ë¡œì íŠ¸ê·¸ë£¹',type:'edu',amount:289700,title:'Gemini ì—°ê°„',date:'2026-02-10',status:'ì™„ë£Œ',year:2026},
  {id:27,name:'ê¹€ì„¸ë¦¬',empno:'EM3523003',dept:'ì†”ë£¨ì…˜ì˜ì—…2ê·¸ë£¹',type:'edu',amount:32315,title:'ChatGPT',date:'2026-02-10',status:'ì™„ë£Œ',year:2026},
  {id:28,name:'ê¹€ìš°ì •',empno:'EM3314003',dept:'ì¸ì¬ì„±ì¥íŒŒíŠ¸',type:'edu',amount:139000,title:'High Five 26 ì»¨í¼ëŸ°ìŠ¤',date:'2026-02-10',status:'ì™„ë£Œ',year:2026},
  {id:29,name:'ì œìœ¤ì„ ',empno:'EM3417007',dept:'ì¸ì¬ì„±ì¥íŒŒíŠ¸',type:'edu',amount:139000,title:'í•˜ì´íŒŒì´ë¸Œ 2026',date:'2026-02-10',status:'ì™„ë£Œ',year:2026},
  {id:30,name:'ì‹ ì°½í˜¸',empno:'EM3417007',dept:'ì¸ì¬ì„±ì¥íŒŒíŠ¸',type:'edu',amount:139000,title:'ì›í‹°ë“œ HR í•˜ì´íŒŒì´ë¸Œ',date:'2026-02-10',status:'ì™„ë£Œ',year:2026},
  {id:31,name:'ì´í›„ì¤€',empno:'EM1314001',dept:'SVC 1ê·¸ë£¹',type:'edu',amount:150000,title:'Claude code MAX',date:'2026-02-10',status:'ì™„ë£Œ',year:2026},
  {id:32,name:'ì•ˆì¬ì˜',empno:'EM3510033',dept:'o9ê°œë°œíŒŒíŠ¸',type:'edu',amount:322209,title:'Claude ì—°ê°„',date:'2026-02-09',status:'ì™„ë£Œ',year:2026},
  {id:33,name:'ì•ˆì¬ì°¬',empno:'EM3218001',dept:'PMOê·¸ë£¹',type:'edu',amount:32555,title:'ChatGPT',date:'2026-02-09',status:'ì™„ë£Œ',year:2026},
  {id:34,name:'ë…¸ì§€ì€',empno:'EM2922001',dept:'ì¬ë¬´ê·¸ë£¹',type:'edu',amount:11000,title:'Gemini (2ê°œì›”)',date:'2026-02-09',status:'ì™„ë£Œ',year:2026},
  {id:35,name:'ì—„ì˜ˆë¦¼',empno:'EM3616007',dept:'ê¸°ë°˜ê¸°ìˆ ì„œë¹„ìŠ¤íŒŒíŠ¸',type:'edu',amount:116000,title:'ChatGPT (4ê°œì›”)',date:'2026-02-09',status:'ì™„ë£Œ',year:2026},
  {id:36,name:'ê¹€ì •ì¸',empno:'EM3510005',dept:'MFG 1íŒŒíŠ¸',type:'edu',amount:29000,title:'ChatGPT',date:'2026-02-06',status:'ì™„ë£Œ',year:2026},
  {id:37,name:'ì€ì¢…ì—½',empno:'EM3310014',dept:'í”„ë¡œì íŠ¸íŒŒíŠ¸',type:'edu',amount:326942,title:'claude ì—°ê°„',date:'2026-02-06',status:'ì™„ë£Œ',year:2026},
  {id:38,name:'ì •ì¬ì‹',empno:'EM3214001',dept:'Technicalì»¨ì„¤íŒ…ê·¸ë£¹',type:'edu',amount:29000,title:'CHATGPT ì˜¨ë¼ì¸ êµ¬ë…',date:'2026-02-06',status:'ì™„ë£Œ',year:2026},
  {id:39,name:'ìµœì¸ì¬',empno:'EM3313016',dept:'SVC 1íŒŒíŠ¸',type:'edu',amount:281299,title:'Cursor Pro ì—°ê°„',date:'2026-02-05',status:'ì™„ë£Œ',year:2026},
  {id:40,name:'ì •ì£¼í¬',empno:'EM3614003',dept:'SVC 1íŒŒíŠ¸',type:'edu',amount:319000,title:'Gemini (11ê°œì›”)',date:'2026-02-05',status:'ì™„ë£Œ',year:2026},
  {id:41,name:'ì´ë™ì˜',empno:'EM3213012',dept:'DevOpsê·¸ë£¹',type:'edu',amount:33145,title:'chat gpt',date:'2026-02-05',status:'ì™„ë£Œ',year:2026},
  {id:42,name:'í™ì˜ˆì§€',empno:'EM3510009',dept:'SourcingíŒŒíŠ¸',type:'edu',amount:158653,title:'Claude.ai',date:'2026-02-05',status:'ì™„ë£Œ',year:2026},
  {id:43,name:'ìµœê±´ì˜',empno:'EM3223016',dept:'P&C 3íŒŒíŠ¸',type:'edu',amount:31281,title:'CURSOR AI',date:'2026-02-05',status:'ì™„ë£Œ',year:2026},
  {id:44,name:'ê¹€ìŠ¹ìš©',empno:'EM1219003',dept:'Technicalì»¨ì„¤íŒ…íŒ€',type:'edu',amount:382900,title:'chatGPT pro (12ê°œì›”)',date:'2026-02-04',status:'ì™„ë£Œ',year:2026},
  {id:45,name:'ì†ì¢…ì€',empno:'EM3623004',dept:'ì •ë³´ì „ëµê·¸ë£¹',type:'edu',amount:29000,title:'Chat GPT Plus',date:'2026-02-04',status:'ì™„ë£Œ',year:2026},
  {id:46,name:'ì´ë™ìœ¨',empno:'EM3618001',dept:'ì˜ì—…ê¸°íšê·¸ë£¹',type:'edu',amount:32643,title:'ChatGPT',date:'2026-02-04',status:'ì™„ë£Œ',year:2026},
  {id:47,name:'ìœ¤ì˜ˆë¦¼',empno:'EM3515016',dept:'ì˜ì—…ê¸°íšê·¸ë£¹',type:'edu',amount:349800,title:'Chat GPT (11ê°œì›”)',date:'2026-02-04',status:'ì™„ë£Œ',year:2026},
  {id:48,name:'ì´ê²½ì§„',empno:'EM2114004',dept:'ê¸°ìˆ ì§€ì›íŒŒíŠ¸',type:'edu',amount:33232,title:'ChatGPT',date:'2026-02-04',status:'ì™„ë£Œ',year:2026},
  {id:49,name:'ì—¬ëª…',empno:'EM3616020',dept:'ê¸€ë¡œë²Œì‚¬ì—…ê¸°íšê·¸ë£¹',type:'edu',amount:33523,title:'Chat GPT',date:'2026-02-04',status:'ì™„ë£Œ',year:2026},
  {id:50,name:'í—ˆì„¤',empno:'EM3410010',dept:'í”Œë«í¼íŒŒíŠ¸',type:'edu',amount:33098,title:'claude êµ¬ë…',date:'2026-02-03',status:'ì™„ë£Œ',year:2026},
  {id:51,name:'ì´ì§€í™˜',empno:'EM3223008',dept:'Cloudìš´ì˜íŒŒíŠ¸',type:'edu',amount:31712,title:'Claude',date:'2026-02-03',status:'ì™„ë£Œ',year:2026},
  {id:52,name:'ë…¸ìœ ë¦¬',empno:'EM2810002',dept:'ì˜ì—…ì§€ì›ê·¸ë£¹',type:'edu',amount:121000,title:'Gemini (11ê°œì›”)',date:'2026-02-03',status:'ì™„ë£Œ',year:2026},
  {id:53,name:'ë…¸ìœ ë¦¬',empno:'EM2810002',dept:'ì˜ì—…ì§€ì›ê·¸ë£¹',type:'edu',amount:52728,title:'chatGPT (3ê°œì›”)',date:'2026-02-03',status:'ì™„ë£Œ',year:2026},
  {id:54,name:'ì´ì •ìˆ˜',empno:'EM3122006',dept:'SVC 2ê·¸ë£¹',type:'edu',amount:208000,title:'ë°”ì´ë¸Œì½”ë”© íŒ¨ìŠ¤íŠ¸ìº í¼ìŠ¤',date:'2026-02-03',status:'ì™„ë£Œ',year:2026},
  {id:55,name:'ê¹€ë™í•˜',empno:'EM3616001',dept:'ì†”ë£¨ì…˜ì˜ì—…2ê·¸ë£¹',type:'edu',amount:99000,title:'ë§í•´ë³´ì¹´',date:'2026-02-03',status:'ì™„ë£Œ',year:2026},
  {id:56,name:'ë°•ì°½í™˜',empno:'EM3619003',dept:'D2Sê·¸ë£¹',type:'edu',amount:32430,title:'Chat GPT',date:'2026-02-02',status:'ì™„ë£Œ',year:2026},
  {id:57,name:'ê¹€í˜„ì£¼',empno:'EM3613001',dept:'í”Œë«í¼ìš´ì˜ê·¸ë£¹',type:'edu',amount:129000,title:'ìŠ¤í”½',date:'2026-02-02',status:'ì™„ë£Œ',year:2026},
  {id:58,name:'ê°•ê²½ë¬µ',empno:'EM3213004',dept:'ìƒí’ˆê¸°íšê·¸ë£¹',type:'edu',amount:31908,title:'chat GPT',date:'2026-02-02',status:'ì™„ë£Œ',year:2026},
  {id:59,name:'ê¹€ì¢…í™”',empno:'EM3512002',dept:'ì¸í”„ë¼íŒŒíŠ¸',type:'edu',amount:290000,title:'Gemini AI Pro ì—°ê°„',date:'2026-02-02',status:'ì™„ë£Œ',year:2026},
  {id:60,name:'ì„ì˜ì£¼',empno:'EM3223015',dept:'MFG 4íŒŒíŠ¸',type:'edu',amount:29000,title:'ChatGPT',date:'2026-02-02',status:'ì™„ë£Œ',year:2026},
  {id:61,name:'ê¹€ì™„ì„­',empno:'EM2422003',dept:'AIì†”ë£¨ì…˜íŒŒíŠ¸',type:'edu',amount:123750,title:'í´ë¡œë“œ ì½”ë“œ ì™„ë²½ ë§ˆìŠ¤í„°',date:'2026-02-02',status:'ë°˜ì†¡',year:2026},
  {id:62,name:'ê¹€ì™„ì„­',empno:'EM2422003',dept:'AIì†”ë£¨ì…˜íŒŒíŠ¸',type:'edu',amount:320000,title:'í´ë¡œë“œ ì—°ê°„',date:'2026-02-02',status:'ì™„ë£Œ',year:2026},
  {id:63,name:'ê¹€ì¬ì—°',empno:'EM3614002',dept:'SVC 2íŒŒíŠ¸',type:'edu',amount:30000,title:'CURSOR AI',date:'2026-02-02',status:'ì™„ë£Œ',year:2026},
  {id:64,name:'ì´ì°½í•œ',empno:'EM3410006',dept:'P2PíŒŒíŠ¸',type:'edu',amount:320700,title:'Claude Code ì—°ê°„',date:'2026-02-02',status:'ì™„ë£Œ',year:2026},
  {id:65,name:'ì •ì£¼ì˜',empno:'EM3614009',dept:'ë””ìì¸ê·¸ë£¹',type:'edu',amount:187000,title:'í´ë¡œë“œ',date:'2026-02-02',status:'ì™„ë£Œ',year:2026},
  {id:66,name:'ê¶Œí˜œì§„',empno:'EM3223003',dept:'ë””ìì¸ê·¸ë£¹',type:'edu',amount:198000,title:'chatGPT (6ê°œì›”)',date:'2026-02-02',status:'ì™„ë£Œ',year:2026},
  {id:67,name:'ì¥ìˆ˜ì •',empno:'EM3616014',dept:'AIì—°êµ¬2íŒŒíŠ¸',type:'edu',amount:29000,title:'ChatGPT',date:'2026-02-02',status:'ì™„ë£Œ',year:2026},
  {id:68,name:'ê¹€ë‹¤í˜„',empno:'EM3310006',dept:'CommoníŒŒíŠ¸',type:'edu',amount:90000,title:'chatGPT êµ¬ë… (3ê°œì›”)',date:'2026-02-02',status:'ì™„ë£Œ',year:2026},
  {id:69,name:'ì˜¤ì •ì‹',empno:'EM2712004',dept:'ì†”ë£¨ì…˜í’ˆì§ˆê·¸ë£¹',type:'edu',amount:31000,title:'Cursor Pro ì›”ê°„',date:'2026-02-02',status:'ì™„ë£Œ',year:2026},
  {id:70,name:'ê¹€ì§€ì€',empno:'EM3223011',dept:'DS 1íŒŒíŠ¸',type:'edu',amount:29000,title:'ChatGPT 1ì›”',date:'2026-02-02',status:'ì™„ë£Œ',year:2026},
  {id:71,name:'ì§„ê²½ì„ ',empno:'EM3613003',dept:'ì˜ì—…ê¸°íšê·¸ë£¹',type:'edu',amount:109000,title:'ìŠ¤í”½ ì—°ê°„',date:'2026-02-02',status:'ì™„ë£Œ',year:2026},
  {id:72,name:'ê¹€ë‹¤í˜„',empno:'EM3310006',dept:'CommoníŒŒíŠ¸',type:'edu',amount:30000,title:'chatGPT êµ¬ë…',date:'2026-02-02',status:'ë°˜ì†¡',year:2026},
  {id:73,name:'ê¹€íƒœí›ˆ',empno:'EM3223012',dept:'MFG 1íŒŒíŠ¸',type:'edu',amount:29000,title:'ChatGPT 2ì›”',date:'2026-02-02',status:'ì™„ë£Œ',year:2026},
  {id:74,name:'ê¹€ì¢…ê±´',empno:'EM3122004',dept:'PMOê·¸ë£¹',type:'edu',amount:29000,title:'Chat GPT',date:'2026-02-02',status:'ì™„ë£Œ',year:2026},
  {id:75,name:'ê¹€ì§€ì€',empno:'EM3223011',dept:'DS 1íŒŒíŠ¸',type:'edu',amount:29000,title:'ChatGPT 1ì›”',date:'2026-01-30',status:'ë°˜ì†¡',year:2026},
  {id:76,name:'ì„±ì§„',empno:'EM3510030',dept:'D2Sê·¸ë£¹',type:'edu',amount:31610,title:'Claude.ai',date:'2026-01-30',status:'ì™„ë£Œ',year:2026},
  {id:77,name:'ì´ë³‘í™”',empno:'EM2223006',dept:'í‘œì¤€í™”ê·¸ë£¹',type:'edu',amount:98000,title:'ë§í•´ë³´ì¹´ ì˜ë‹¨ì–´',date:'2026-01-30',status:'ì™„ë£Œ',year:2026},
  {id:78,name:'ìœ ì§€ë‚˜',empno:'EM3410018',dept:'AIì„œë¹„ìŠ¤íŒŒíŠ¸',type:'edu',amount:60000,title:'Claude (2ê°œì›”)',date:'2026-01-30',status:'ì™„ë£Œ',year:2026},
  {id:79,name:'ìœ ì§€ë‚˜',empno:'EM3410018',dept:'AIì„œë¹„ìŠ¤íŒŒíŠ¸',type:'edu',amount:58000,title:'ChatGPT (2ê°œì›”)',date:'2026-01-30',status:'ì™„ë£Œ',year:2026},
  {id:80,name:'ìµœìŠ¹ë¯¸',empno:'EM3418001',dept:'ì¬ë¬´ê·¸ë£¹',type:'edu',amount:29000,title:'chat gpt',date:'2026-01-30',status:'ì™„ë£Œ',year:2026},
  {id:81,name:'í•œê·œë¹„',empno:'EM3317006',dept:'PRMê·¸ë£¹',type:'edu',amount:29000,title:'chat GPT Plus',date:'2026-01-30',status:'ì™„ë£Œ',year:2026},
  {id:82,name:'ê¹€ë™í•˜',empno:'EM3616001',dept:'ì†”ë£¨ì…˜ì˜ì—…2ê·¸ë£¹',type:'edu',amount:186000,title:'ChatGPT (6ê°œì›”)',date:'2026-01-29',status:'ì™„ë£Œ',year:2026},
  {id:83,name:'ìœ ì§€ë‚˜',empno:'EM3410018',dept:'AIì„œë¹„ìŠ¤íŒŒíŠ¸',type:'edu',amount:239000,title:'ìŠ¤í”½',date:'2026-01-29',status:'ì™„ë£Œ',year:2026},
  {id:84,name:'ì„œì±„ì—°',empno:'EM3616006',dept:'ê¸°ë°˜ê¸°ìˆ ê°œë°œíŒŒíŠ¸',type:'edu',amount:58800,title:'OPIc',date:'2026-01-29',status:'ì™„ë£Œ',year:2026},
  {id:85,name:'ì¡°ì†Œì˜',empno:'EM3219012',dept:'AIí”Œë«í¼íŒŒíŠ¸',type:'edu',amount:32412,title:'ChatGPT Plus',date:'2026-01-29',status:'ì™„ë£Œ',year:2026},
  {id:86,name:'ì´íƒœì›',empno:'EM3623006',dept:'ì†”ë£¨ì…˜ì˜ì—…1ê·¸ë£¹',type:'edu',amount:261000,title:'ChatGPT Plusêµ¬ë… (9ê°œì›”)',date:'2026-01-29',status:'ë°˜ì†¡',year:2026},
  {id:87,name:'ì •ì—°ì¤€',empno:'EM3510010',dept:'P2PíŒŒíŠ¸',type:'edu',amount:31396,title:'Claude Pro',date:'2026-01-29',status:'ì™„ë£Œ',year:2026},
  {id:88,name:'ê¹€ì„±í›ˆ',empno:'EM2114001',dept:'DevOpsê·¸ë£¹',type:'edu',amount:316866,title:'Claude ì—°ê°„',date:'2026-01-29',status:'ì™„ë£Œ',year:2026},
  {id:89,name:'ê°•ì§€ìš°',empno:'EM3221001',dept:'E&I 1íŒŒíŠ¸',type:'edu',amount:314023,title:'claude ì—°ê°„',date:'2026-01-29',status:'ì™„ë£Œ',year:2026},
  {id:90,name:'ê¹€í˜¸ì •',empno:'EM3419004',dept:'ê¸€ë¡œë²Œë”œë¦¬ë²„ë¦¬ê·¸ë£¹',type:'edu',amount:290000,title:'Google Gemini ì—°ê°„',date:'2026-01-29',status:'ì™„ë£Œ',year:2026},
  {id:91,name:'ë°•ê¸°ì›',empno:'EM3510035',dept:'PMMíŒŒíŠ¸',type:'edu',amount:348000,title:'ChatGPT (12ê°œì›”)',date:'2026-01-29',status:'ì™„ë£Œ',year:2026},
  {id:92,name:'ë³€ìƒì€',empno:'EM3213011',dept:'ì˜ì—…ê¸°íšê·¸ë£¹',type:'edu',amount:145000,title:'Google gemini (5ê°œì›”)',date:'2026-01-28',status:'ì™„ë£Œ',year:2026},
  {id:93,name:'ìš°ì„±í˜„',empno:'EM3616010',dept:'AIì—°êµ¬2íŒŒíŠ¸',type:'edu',amount:157267,title:'Claude Code Max',date:'2026-01-28',status:'ì™„ë£Œ',year:2026},
  {id:94,name:'ì‹ ì°½í˜¸',empno:'EM3417007',dept:'ì¸ì¬ì„±ì¥íŒŒíŠ¸',type:'edu',amount:290000,title:'Google Gemini ì—°ê°„',date:'2026-01-28',status:'ì™„ë£Œ',year:2026},
  {id:95,name:'ìœ¤í˜œì£¼',empno:'EM3219008',dept:'AIí”Œë«í¼íŒŒíŠ¸',type:'edu',amount:156554,title:'Claude',date:'2026-01-28',status:'ì™„ë£Œ',year:2026},
  {id:96,name:'ë¬¸ëŒ€ì˜',empno:'EM3312003',dept:'ê¸°ë°˜ê¸°ìˆ ì„œë¹„ìŠ¤íŒŒíŠ¸',type:'edu',amount:32253,title:'Claude',date:'2026-01-28',status:'ì™„ë£Œ',year:2026},
  {id:97,name:'ê¹€í•œì†”',empno:'EM2912004',dept:'o9ê°œë°œíŒŒíŠ¸',type:'edu',amount:32129,title:'ChatGPT ë§¤ì›”êµ¬ë…',date:'2026-01-28',status:'ì™„ë£Œ',year:2026},
  {id:98,name:'ê¹€ìš°ì •',empno:'EM3314003',dept:'ì¸ì¬ì„±ì¥íŒŒíŠ¸',type:'edu',amount:174000,title:'ì œë¯¸ë§ˆì´ (6ê°œì›”)',date:'2026-01-28',status:'ì™„ë£Œ',year:2026},
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ë°ì´í„° ì†ŒìŠ¤ & í†µê³„
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function src(){return records.length ? records : SAMPLE;}

/**
 * ì§ì›ë³„ í†µê³„ ê³„ì‚°
 * â€» ì§‘ê³„ ê¸°ì¤€: ì„±ëª… + ë¶€ì„œëª…
 *    - ê¸°ì•ˆìì™€ ì„±ëª…(ìˆ˜í˜œì)ì´ ë‹¤ë¥¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë°˜ë“œì‹œ 'ì„±ëª…' ê¸°ì¤€ìœ¼ë¡œ ì§‘ê³„
 *    - ì‚¬ì›ë²ˆí˜¸ëŠ” ê¸°ì•ˆì ë²ˆí˜¸ì´ë¯€ë¡œ grouping keyì—ì„œ ì œì™¸
 *    - ì˜ˆ) ì‹ ì°½í˜¸ê°€ ê¸°ì•ˆ â†’ ì„±ëª…ì´ ì œìœ¤ì„  â†’ ì œìœ¤ì„  ë¹„ìš©ìœ¼ë¡œ ì§‘ê³„
 * confirmed: ì™„ë£Œ í•©ê³„ (í™•ì •)
 * pending:   ì§„í–‰ í•©ê³„ (ì ì •)
 * total:     confirmed + pending (ì ì • í•©ê³„)
 * ë°˜ì†¡ì€ ì™„ì „ ì œì™¸
 */

function getStats(yr){
  yr = yr || curYear;
  const map = {};

  // ì§‘ê³„ ê¸°ì¤€:
  // - ì¼ë°˜: ì‚¬ì›ë²ˆí˜¸(empno) ê¸°ì¤€ â†’ ë™ëª…ì´ì¸ ì •í™•íˆ êµ¬ë¶„
  // - ì œìœ¤ì„  ì˜ˆì™¸: ì„±ëª…(beneficiary)ì´ 'ì œìœ¤ì„ 'ì´ë©´ ê¸°ì•ˆì/ì‚¬ì›ë²ˆí˜¸ ë¬´ê´€í•˜ê²Œ ì œìœ¤ì„ ìœ¼ë¡œ í†µí•©
  //   (ì‹ ì°½í˜¸ ê¸°ì•ˆ, ê¹€í˜•ì°¬ ê¸°ì•ˆ ëª¨ë‘ â†’ ì œìœ¤ì„  í•©ê³„ì— í¬í•¨)
  src().filter(r=>r.year===yr && r.status!=='ë°˜ì†¡').forEach(r=>{
    const bene = r.beneficiary || r.name; // ì‹¤ì œ ìˆ˜í˜œì (ì„±ëª… ì»¬ëŸ¼)
    const isJeYunSeon = bene === 'ì œìœ¤ì„ ';

    // key: ì œìœ¤ì„ ì€ ê³ ì •ê°’, ë‚˜ë¨¸ì§€ëŠ” ì‚¬ì›ë²ˆí˜¸(ì—†ìœ¼ë©´ ì´ë¦„+ë¶€ì„œ)
    const key = isJeYunSeon ? '__ì œìœ¤ì„ __' : (r.empno || `${r.name}||${r.dept}`);

    if(!map[key]){
      map[key] = {
        name: isJeYunSeon ? 'ì œìœ¤ì„ ' : r.name,
        empno: isJeYunSeon ? '' : (r.empno||''),
        dept: isJeYunSeon ? (r.beneficiaryDept||r.dept) : r.dept,
        eduDone:0, bookDone:0, eduPend:0, bookPend:0
      };
    }
    const m = map[key];
    // ì‚¬ë²ˆì€ ë³¸ì¸ ê¸°ì•ˆ ì¼€ì´ìŠ¤ì—ì„œ ì±„ì›€ (ì œìœ¤ì„  ì œì™¸)
    if(!isJeYunSeon && r.applicant===r.name && r.empno && !m.empno) m.empno = r.empno;

    const isDone = (r.status==='ì™„ë£Œ');
    if(r.type==='edu'){
      if(isDone) m.eduDone += r.amount; else m.eduPend += r.amount;
    }else{
      if(isDone) m.bookDone += r.amount; else m.bookPend += r.amount;
    }
  });

  return Object.values(map).map(e=>{
    const done = e.eduDone + e.bookDone;
    const pend = e.eduPend + e.bookPend;
    const total = done + pend;
    return {
      ...e,
      eduTotal: e.eduDone + e.eduPend,
      bookTotal: e.bookDone + e.bookPend,
      done, pend, total,
      donePct: Math.min(Math.round(done/LIMIT*100), 100),
      totalPct: Math.round(total/LIMIT*100)
    };
  });
}

function fmt(n){return Number(n).toLocaleString('ko-KR')+'ì›'}
function fmtK(n){if(n===0)return '0ì›';return n>=10000?Math.round(n/1000)/10+'ë§Œì›':n.toLocaleString()+'ì›'}

function stInfo(totalPct,donePct){
  if(totalPct>100) return{c:'pf',t:'í•œë„ ì´ˆê³¼'};
  if(totalPct>=100) return{c:'pf',t:'í•œë„ ì†Œì§„'};
  if(totalPct>=80)  return{c:'pw',t:'ì£¼ì˜'};
  if(donePct>=80&&donePct<100) return{c:'pp',t:'ì§„í–‰ í¬í•¨ì‹œ ì£¼ì˜'};
  return{c:'ps',t:'ì—¬ìœ '};
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// êµ¬ê¸€ ì‹œíŠ¸ ì—°ë™
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toCsvUrl(url){
  if(!url) return null;
  if(url.includes('output=csv')||url.includes('/pub?')) return url;
  const m=url.match(/\/d\/([a-zA-Z0-9_-]+)/);
  if(!m) return null;
  const gid=(url.match(/gid=(\d+)/)||[,'0'])[1];
  return `https://docs.google.com/spreadsheets/d/${m[1]}/export?format=csv&gid=${gid}`;
}


function parseDateAny(v){
  if(!v) return '';
  const m = String(v).match(/(\d{4})[-./](\d{2})[-./](\d{2})/);
  return m ? `${m[1]}-${m[2]}-${m[3]}` : '';
}
function numOnly(v){
  const s = (v==null?'':String(v));
  const n = parseInt(s.replace(/[^0-9]/g,''),10);
  return isNaN(n)?0:n;
}
function pick(row, keys){
  for(const k of keys){
    const v = row[k];
    if(v!=null && String(v).trim()!=='') return String(v).trim();
  }
  return '';
}

/**
 * CSV íŒŒì‹± (PapaParse ì‚¬ìš©: ë”°ì˜´í‘œ/ì‰¼í‘œ/ì¤„ë°”ê¿ˆ í¬í•¨ ì…€ ì•ˆì „)
 * ë°˜í™˜: { recs: [...], totalRows, parsedRows, skippedRows }
 */
function parseCsv(text,type){
  const cleaned = (text||'').replace(/^\uFEFF/,''); // BOM ì œê±°
  const parsed = Papa.parse(cleaned, { header:true, skipEmptyLines:'greedy' });
  const rows = Array.isArray(parsed.data) ? parsed.data : [];
  const totalRows = rows.length;

  const recs = [];
  let skipped = 0;

  for(const row of rows){
    // ê³µí†µ ì»¬ëŸ¼ëª… ëŒ€ì‘
    const dateRaw = pick(row, ['ì‘ì„±ì¼ì‹œ','ì‘ì„±ì¼','ì‘ì„±ì¼ì','ê¸°ì•ˆì¼','ê¸°ì•ˆì¼ì‹œ']);
    const date = parseDateAny(dateRaw);
    if(!date){ skipped++; continue; }
    const year = parseInt(date.slice(0,4),10);
    if(isNaN(year) || year<2020 || year>2035){ skipped++; continue; }

    const amount = numOnly(pick(row, ['ë¹„ìš©','ê¸ˆì•¡','êµ¬ë§¤ê¸ˆì•¡','ì‹ ì²­ê¸ˆì•¡']));
    if(!amount){ skipped++; continue; }

    const statusRaw = pick(row, ['ê²°ì¬ìƒíƒœ','ê²°ì¬ ìƒíƒœ','ìƒíƒœ','ê²°ì¬']);
    const status = statusRaw.includes('ì™„ë£Œ') ? 'ì™„ë£Œ'
      : (statusRaw.includes('ë°˜ì†¡') || statusRaw.includes('ë°˜ë ¤')) ? 'ë°˜ì†¡'
      : 'ì§„í–‰';

    const applicant = pick(row, ['ê¸°ì•ˆì','ì‹ ì²­ì','ì‘ì„±ì','ìš”ì²­ì']);
    const beneficiary = pick(row, ['ì„±ëª…','ìˆ˜í˜œì','ëŒ€ìƒì','ì‹ ì²­ìëª…']) || applicant;
    const empno = pick(row, ['ì‚¬ì›ë²ˆí˜¸','ì‚¬ë²ˆ','ì‚¬ì› ë²ˆí˜¸','EMP NO','EmpNo']);
    // ê¸°ì•ˆì ë¶€ì„œ vs ìˆ˜í˜œì ë¶€ì„œ êµ¬ë¶„: ë¹„ì¦ˆí”Œë ˆì´ì—ì„œ 'ë¶€ì„œ'=ê¸°ì•ˆìë¶€ì„œ, 'ë¶€ì„œëª…'=ìˆ˜í˜œìë¶€ì„œ
    const dept = pick(row, ['ë¶€ì„œ','ì¡°ì§','ì†Œì†ë¶€ì„œ']) || '';
    const beneficiaryDept = pick(row, ['ë¶€ì„œëª…']) || dept;

    const title = (type==='edu')
      ? (pick(row, ['êµìœ¡ê³¼ì •ëª…','êµìœ¡ ê³¼ì •ëª…','êµìœ¡ëª…','ê³¼ì •ëª…','ì œëª©']) || '')
      : (pick(row, ['ë„ì„œëª…','ë„ì„œ ëª…','ë„ì„œì œëª©','ì œëª©']) || '');

    recs.push({
      id: uid++,
      name: beneficiary,           // í™”ë©´/ì§‘ê³„ ê¸°ì¤€ ì´ë¦„ = ì„±ëª…
      applicant,                   // ê¸°ì•ˆì(ëŒ€ë¦¬ê¸°ì•ˆ í‘œì‹œìš©)
      beneficiary,                 // ì‹¤ì œ ìˆ˜í˜œì (ì œìœ¤ì„  ì˜ˆì™¸ì²˜ë¦¬ìš©)
      beneficiaryDept,             // ìˆ˜í˜œì ë¶€ì„œ
      empno,
      dept,
      type,
      amount,
      title,
      date,
      status,
      year
    });
  }

  return { recs, totalRows, parsedRows: recs.length, skippedRows: skipped };
}


async function loadSheets(){
  const eu=document.getElementById('eduUrl').value.trim();
  const bu=document.getElementById('bookUrl').value.trim();
  if(!eu&&!bu){toast('êµ¬ê¸€ ì‹œíŠ¸ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');return;}

  setConn('spin','ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');
  const newRecs=[];const meta=[];let ok=0;

  for(const[url,type] of[[eu,'edu'],[bu,'book']]){
    if(!url) continue;
    try{
      const csvUrl=toCsvUrl(url);
      if(!csvUrl) throw new Error('URL í˜•ì‹ ì˜¤ë¥˜');
      const bust = (csvUrl.includes('?')?'&':'?') + '_=' + Date.now();
      const res=await fetch(csvUrl + bust, {cache:'no-store'});
      if(!res.ok) throw new Error(`HTTP ${res.status}`);
      const text=await res.text();
      const parsed=parseCsv(text,type);
      newRecs.push(...parsed.recs);
      meta.push({type, ...parsed});
      ok++;
    }catch(e){toast(`${type==='edu'?'êµìœ¡':'ë„ì„œ'} ì‹œíŠ¸ ì˜¤ë¥˜: ${e.message}`);}
  }

  if(ok>0){
    records=[...records.filter(r=>r._m),...newRecs];
    const detail = meta.map(m=>`${m.type==='edu'?'êµìœ¡':'ë„ì„œ'}: ì´ ${m.totalRows}í–‰ â†’ ${m.parsedRows}ê±´ (ìŠ¤í‚µ ${m.skippedRows})`).join(' Â· ');
    setConn('ok',`ì—°ê²°ë¨ Â· ${newRecs.length}ê±´ ë¡œë“œ ì™„ë£Œ (${detail})`);
    document.getElementById('howto').style.display='none';
    renderAll();
    toast(`âœ… ${newRecs.length}ê±´ ë¡œë“œ ì™„ë£Œ!\n${detail}`);
  } else{setConn('','ì—°ê²° ì‹¤íŒ¨');}
}

function setConn(cls,txt){
  document.getElementById('cdot').className='cdot'+(cls?' '+cls:'');
  document.getElementById('ctext').textContent=txt;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ë Œë”ë§
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAll(){renderSummary();renderTable();}

function renderSummary(){
  const emps=getStats();
  const s=src().filter(r=>r.year===curYear);
  const tD=emps.reduce((a,e)=>a+e.done,0);
  const tP=emps.reduce((a,e)=>a+e.pend,0);
  const tT=tD+tP;
  const tL=emps.length*LIMIT;
  const avgDone=emps.length?Math.round(tD/tL*100):0;
  const avgTotal=emps.length?Math.round(tT/tL*100):0;
  const remain=Math.max(0,tL-tT);
  const overCount=emps.filter(e=>e.totalPct>=100).length;

  document.getElementById('sgrid').innerHTML=`
    <div class="sc c0">
      <div class="sc-lbl">ì ì • ì´ ì‚¬ìš©ì•¡</div>
      <div class="sc-num">${fmtK(tT)}</div>
      <div class="sc-sub">í™•ì • ${fmtK(tD)} + ì§„í–‰ ${fmtK(tP)}</div>
      <div class="sc-bar"><div class="sc-bfill" style="width:${Math.min(avgTotal,100)}%;background:var(--accent)"></div></div>
    </div>
    <div class="sc c1">
      <div class="sc-lbl">êµìœ¡ë¹„</div>
      <div class="sc-num" style="color:var(--edu)">${fmtK(emps.reduce((a,e)=>a+e.eduTotal,0))}</div>
      <div class="sc-sub">${s.filter(r=>r.type==='edu'&&r.status!=='ë°˜ì†¡').length}ê±´ (ë°˜ì†¡ ì œì™¸)</div>
    </div>
    <div class="sc c2">
      <div class="sc-lbl">ë„ì„œë¹„</div>
      <div class="sc-num" style="color:var(--book)">${fmtK(emps.reduce((a,e)=>a+e.bookTotal,0))}</div>
      <div class="sc-sub">${s.filter(r=>r.type==='book'&&r.status!=='ë°˜ì†¡').length}ê±´ (ë°˜ì†¡ ì œì™¸)</div>
    </div>
    <div class="sc c3">
      <div class="sc-lbl">ì§„í–‰ ì¤‘ (ì ì •)</div>
      <div class="sc-num" style="color:var(--pend)">${fmtK(tP)}</div>
      <div class="sc-sub">${s.filter(r=>r.status==='ì§„í–‰').length}ê±´ ê²°ì¬ ëŒ€ê¸°</div>
    </div>
    <div class="sc c4">
      <div class="sc-lbl">1ì¸ í‰ê·  ì”ì—¬</div>
      <div class="sc-num" style="color:var(--accent2)">${emps.length?fmtK(Math.round((tL-tT)/emps.length)):'â”€'}</div>
      <div class="sc-sub">í•œë„ 50ë§Œì› ê¸°ì¤€</div>
    </div>
    <div class="sc c5">
      <div class="sc-lbl">í•œë„ ì†Œì§„/ì´ˆê³¼</div>
      <div class="sc-num" style="color:${overCount>0?'var(--danger)':'var(--text)'}">${overCount}ëª…</div>
      <div class="sc-sub">ì´ ${emps.length}ëª… ì¤‘</div>
    </div>
  `;

  // 2ë‹¨ ë°”
  const doneW=Math.min(avgDone,100);
  const pendW=Math.min(avgTotal,100)-doneW;
  document.getElementById('avgDone').style.width=doneW+'%';
  document.getElementById('avgPend').style.left=doneW+'%';
  document.getElementById('avgPend').style.width=Math.max(pendW,0)+'%';
  document.getElementById('avgPct').textContent=avgTotal+'%';
  document.getElementById('yLabel').textContent=curYear+'ë…„';
}

function renderTable(){
  const emps=getStats();
  const srch=document.getElementById('srch').value.toLowerCase();
  const tf=document.getElementById('tf').value;
  const sf=document.getElementById('sf').value;

  let list=emps.filter(e=>{
    if(srch && !e.name.toLowerCase().includes(srch) && !e.dept.toLowerCase().includes(srch) && !String(e.empno||'').toLowerCase().includes(srch)) return false;
    if(tf==='edu'&&e.eduTotal===0) return false;
    if(tf==='book'&&e.bookTotal===0) return false;
    if(sf==='safe'&&e.totalPct>=80) return false;
    if(sf==='warn'&&(e.totalPct<80||e.totalPct>=100)) return false;
    if(sf==='full'&&e.totalPct<100) return false;
    if(sf==='over'&&e.totalPct<=100) return false;
    return true;
  }).sort((a,b)=>b.total-a.total);

  const tb=document.getElementById('etbody');
  if(!list.length){tb.innerHTML='<tr><td colspan="8" class="nodata">ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';return;}

  tb.innerHTML=list.map(e=>{
    const si=stInfo(e.totalPct,e.donePct);
    const tag=e.eduTotal>0&&e.bookTotal>0?'<span class="badge bbt">êµìœ¡+ë„ì„œ</span>'
      :e.eduTotal>0?'<span class="badge be">êµìœ¡</span>'
      :e.bookTotal>0?'<span class="badge bb">ë„ì„œ</span>':'<span class="badge bn">ì—†ìŒ</span>';
    const doneW=Math.min(e.donePct,100);
    const pendW=Math.max(0,Math.min(e.totalPct,100)-doneW);
    const remain=Math.max(0,LIMIT-e.total);
    const barColor=e.totalPct>=100?'var(--danger)':e.totalPct>=80?'var(--warn)':'var(--accent)';

    return `<tr>
      <td class="emp-name-cell">
        <div class="name">${e.name} ${tag}</div>
        <div class="dept">${e.dept}</div>
      </td>
      <td><span style="font-family:'IBM Plex Mono',monospace;font-size:11px;color:var(--text3)">${e.empno}</span></td>
      <td class="amt-stack">
        <div class="confirmed" style="color:var(--edu)">${fmt(e.eduDone)}</div>
        ${e.eduPend>0?`<div class="pending-amt">+${fmt(e.eduPend)} ì§„í–‰</div>`:''}
      </td>
      <td class="amt-stack">
        <div class="confirmed" style="color:var(--book)">${fmt(e.bookDone)}</div>
        ${e.bookPend>0?`<div class="pending-amt">+${fmt(e.bookPend)} ì§„í–‰</div>`:''}
      </td>
      <td class="amt-stack">
        <div class="confirmed mono">${fmt(e.total)}</div>
        ${e.pend>0?`<div style="font-size:10px;color:var(--pend);margin-top:2px;font-family:'IBM Plex Mono',monospace">(í™•ì • ${fmt(e.done)})</div>`:''}
      </td>
      <td class="lbar-wrap">
        <div class="lbar-labels">
          <span>${e.totalPct}%${e.pend>0?'<span style="color:var(--pend);font-size:9px"> ì ì •</span>':''}</span>
          <span class="pct">${e.donePct}% í™•ì •</span>
        </div>
        <div class="lbar-track">
          <div class="lbar-done" style="width:${doneW}%;background:${barColor}"></div>
          <div class="lbar-pend-stripe" style="left:${doneW}%;width:${pendW}%"></div>
        </div>
        <div class="lbar-remain">ì”ì—¬ ${fmt(remain)}</div>
      </td>
      <td><span class="pill ${si.c}">${si.t}</span></td>
      <td><button class="rbtn" onclick="showDetail('${encodeURIComponent(e.empno)}','${encodeURIComponent(e.name)}','${encodeURIComponent(e.dept)}')">ìƒì„¸ â†’</button></td>
    </tr>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ì§ì› ìƒì„¸
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showDetail(eno,nn,dn){
  const empno=decodeURIComponent(eno),name=decodeURIComponent(nn),dept=decodeURIComponent(dn);
  const emps=getStats();
  // ì œìœ¤ì„ ì€ empnoê°€ ê¸°ì•ˆì ê²ƒì´ë¯€ë¡œ ì´ë¦„ìœ¼ë¡œë§Œ ë§¤ì¹­
  const emp=emps.find(e=>e.name===name && e.dept===dept);
  if(!emp) return;

  // í•´ë‹¹ ì§ì›ì˜ ë ˆì½”ë“œ: ì œìœ¤ì„ ì´ë©´ beneficiary ê¸°ì¤€, ì•„ë‹ˆë©´ empno ê¸°ì¤€
  const recs=src().filter(r=>r.year===curYear && r.name===name && r.dept===dept);
  const si=stInfo(emp.totalPct,emp.donePct);
  const cs=['#4f8cff','#34d399','#fb923c','#a78bfa','#f472b6','#38bdf8'];
  const ci=name.charCodeAt(0)%cs.length;
  const doneW=Math.min(emp.donePct,100);
  const pendW=Math.max(0,Math.min(emp.totalPct,100)-doneW);

  document.getElementById('listSec').style.display='none';
  document.getElementById('detSec').style.display='block';
  document.getElementById('detContent').innerHTML=`
    <div class="det-ehdr">
      <div class="det-avatar" style="background:linear-gradient(135deg,${cs[ci]},${cs[(ci+2)%6]})">${name[0]}</div>
      <div>
        <div class="det-name">${name} <span style="font-size:12px;color:var(--text3);font-weight:400">${emp.empno}</span></div>
        <div class="det-info">${emp.dept} Â· ${curYear}ë…„</div>
      </div>
      <span class="pill ${si.c}" style="align-self:flex-start;margin-left:auto">${si.t}</span>
    </div>

    <div class="gcard">
      <div class="gcard-top">
        <div class="gcard-main">
          <div class="lbl">ì ì • í•©ê³„ (ì™„ë£Œ + ì§„í–‰)</div>
          <div class="used" style="color:${emp.totalPct>=80?'var(--warn)':'var(--accent)'}">${fmt(emp.total)}</div>
          <div class="used-sub">í™•ì • <b style="color:var(--text)">${fmt(emp.done)}</b> + ì§„í–‰ <span style="color:var(--pend);font-family:'IBM Plex Mono',monospace">${fmt(emp.pend)}</span></div>
        </div>
        <div class="gcard-right">
          <div class="rem-lbl">ì”ì—¬ í•œë„</div>
          <div class="rem" style="color:${emp.totalPct>=80?'var(--danger)':'var(--text2)'}">${fmt(Math.max(0,LIMIT-emp.total))}</div>
          <div class="lim">í•œë„ ${fmt(LIMIT)}</div>
        </div>
      </div>
      <div class="bigtrack">
        <div class="bigdone" style="width:${doneW}%;background:${emp.totalPct>=80?'var(--warn)':''}"></div>
        <div class="bigpend" style="left:${doneW}%;width:${pendW}%"></div>
      </div>
      <div class="gcard-legend">
        <div class="gl-item"><div class="gl-dot" style="background:var(--edu)"></div>êµìœ¡ í™•ì • <span style="color:var(--edu);font-family:'IBM Plex Mono',monospace;margin-left:3px">${fmt(emp.eduDone)}</span></div>
        <div class="gl-item"><div class="gl-dot" style="background:var(--book)"></div>ë„ì„œ í™•ì • <span style="color:var(--book);font-family:'IBM Plex Mono',monospace;margin-left:3px">${fmt(emp.bookDone)}</span></div>
        ${emp.pend>0?`<div class="gl-item"><div class="gl-dot pend"></div>ì§„í–‰ ì¤‘ (ì ì •) <span style="color:var(--pend);font-family:'IBM Plex Mono',monospace;margin-left:3px">${fmt(emp.pend)}</span></div>`:''}
      </div>
    </div>

    <div class="twrap">
      <div style="padding:12px 16px;border-bottom:1px solid var(--border);font-size:13px;font-weight:600;color:var(--text2)">
        ì‹ ì²­ ë‚´ì—­ (${recs.length}ê±´)
        <span style="float:right;font-size:11px;color:var(--text3);font-weight:400">ë°˜ì†¡ í¬í•¨ ì „ì²´</span>
      </div>
      <table>
        <thead><tr><th>ì¼ì</th><th>ìœ í˜•</th><th>ê³¼ì •ëª… / ë„ì„œëª…</th><th>ê¸ˆì•¡</th><th>ê¸°ì•ˆì</th><th>ìƒíƒœ</th></tr></thead>
        <tbody>
          ${recs.length?recs.sort((a,b)=>new Date(b.date)-new Date(a.date)).map(r=>`
            <tr style="${r.status==='ë°˜ì†¡'?'opacity:.45':''}">
              <td style="font-family:'IBM Plex Mono',monospace;font-size:11px;color:var(--text3)">${r.date}</td>
              <td><span class="badge ${r.type==='edu'?'be':'bb'}">${r.type==='edu'?'êµìœ¡':'ë„ì„œ'}</span></td>
              <td style="max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap" title="${r.title}">${r.title}</td>
              <td><span class="mono">${fmt(r.amount)}</span></td>
              <td style="font-size:11px;color:var(--text3)">
                ${((r.applicant||r.name)!==(r.beneficiary||r.name))
                  ?`<span style="color:var(--warn)" title="ëŒ€ë¦¬ ê¸°ì•ˆ">âš‘ ${r.applicant}</span>`
                  :'â”€'}
              </td>
              <td style="font-size:12px">
                ${r.status==='ì™„ë£Œ'?'<span style="color:var(--edu)">âœ… ì™„ë£Œ</span>'
                  :r.status==='ì§„í–‰'?'<span style="color:var(--pend)">â³ ì§„í–‰ ì¤‘</span>'
                  :'<span style="color:var(--danger)">âŒ ë°˜ì†¡</span>'}
              </td>
            </tr>`).join('')
            :'<tr><td colspan="6" class="nodata">ì‹ ì²­ ë‚´ì—­ ì—†ìŒ</td></tr>'}
        </tbody>
      </table>
    </div>
  `;
}

function goBack(){
  document.getElementById('detSec').style.display='none';
  document.getElementById('listSec').style.display='block';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ì§ì› ì¡°íšŒ ë·°
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function populateDepts(){
  const depts=[...new Set(getStats().map(e=>e.dept))].sort();
  document.getElementById('lkDept').innerHTML=
    '<option value="">ë¶€ì„œ ì„ íƒ (ì„ íƒì‚¬í•­)</option>'+
    depts.map(d=>`<option>${d}</option>`).join('');
}

function doLookup(){
  const name=document.getElementById('lkName').value.trim();
  const dept=document.getElementById('lkDept').value;
  if(!name){toast('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');return;}
  let emps=getStats().filter(e=>e.name===name);
  if(dept) emps=emps.filter(e=>e.dept===dept);
  const el=document.getElementById('lkResult');
  if(!emps.length){
    el.className='lkresult show';
    el.innerHTML=`<div style="text-align:center;color:var(--text3);padding:14px"><div style="font-size:26px;margin-bottom:8px">ğŸ¤”</div>ë‚´ì—­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br><span style="font-size:12px">ë¶€ì„œë¥¼ ì„ íƒí•˜ê±°ë‚˜ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.</span></div>`;
    return;
  }
  const emp=emps[0];
  const si=stInfo(emp.totalPct,emp.donePct);
  const doneW=Math.min(emp.donePct,100);
  const pendW=Math.max(0,Math.min(emp.totalPct,100)-doneW);
  const recs=src().filter(r=>r.year===curYear&&r.status!=='ë°˜ì†¡'&&(
    emp.name==='ì œìœ¤ì„ '
      ? (r.beneficiary||r.name)==='ì œìœ¤ì„ '
      : r.name===emp.name&&(dept?r.dept===dept:true)
  ));

  el.className='lkresult show';
  el.innerHTML=`
    <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:11px;flex-wrap:wrap;gap:6px">
      <div>
        <div style="font-weight:700;font-size:15px">${emp.name}</div>
        <div style="font-size:11px;color:var(--text3)">${emp.dept} Â· ${curYear}ë…„</div>
      </div>
      <span class="pill ${si.c}">${si.t}</span>
    </div>
    <div class="bigtrack" style="height:8px;margin-bottom:7px">
      <div class="bigdone" style="width:${doneW}%"></div>
      <div class="bigpend" style="left:${doneW}%;width:${pendW}%"></div>
    </div>
    <div style="display:flex;justify-content:space-between;font-size:12px;color:var(--text3);margin-bottom:12px">
      <span>ì ì • í•©ê³„ <span style="color:var(--text);font-weight:600;font-family:'IBM Plex Mono',monospace">${fmt(emp.total)}</span></span>
      <span>ì”ì—¬ <span style="color:${emp.totalPct>=80?'var(--danger)':'var(--edu)'};font-weight:600;font-family:'IBM Plex Mono',monospace">${fmt(Math.max(0,LIMIT-emp.total))}</span></span>
    </div>
    <div style="background:rgba(96,165,250,.06);border:1px solid rgba(96,165,250,.15);border-radius:8px;padding:9px 12px;font-size:11px;color:var(--text3);margin-bottom:12px">
      âœ… í™•ì • <b style="color:var(--text);font-family:'IBM Plex Mono',monospace">${fmt(emp.done)}</b>
      &nbsp;+&nbsp; â³ ì§„í–‰ ì¤‘ <b style="color:var(--pend);font-family:'IBM Plex Mono',monospace">${fmt(emp.pend)}</b>
      &nbsp;= ì ì • í•©ê³„ <b style="color:var(--text)">${fmt(emp.total)}</b>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px">
      <div style="background:rgba(52,211,153,.06);border:1px solid rgba(52,211,153,.14);border-radius:9px;padding:11px;text-align:center">
        <div style="font-size:10px;color:var(--text3);margin-bottom:4px">ğŸ“– êµìœ¡ë¹„</div>
        <div style="font-family:'IBM Plex Mono',monospace;font-weight:600;color:var(--edu)">${fmt(emp.eduTotal)}</div>
        ${emp.eduPend>0?`<div style="font-size:10px;color:var(--pend);margin-top:2px">ì§„í–‰ ${fmt(emp.eduPend)}</div>`:''}
      </div>
      <div style="background:rgba(251,146,60,.06);border:1px solid rgba(251,146,60,.14);border-radius:9px;padding:11px;text-align:center">
        <div style="font-size:10px;color:var(--text3);margin-bottom:4px">ğŸ“š ë„ì„œë¹„</div>
        <div style="font-family:'IBM Plex Mono',monospace;font-weight:600;color:var(--book)">${fmt(emp.bookTotal)}</div>
        ${emp.bookPend>0?`<div style="font-size:10px;color:var(--pend);margin-top:2px">ì§„í–‰ ${fmt(emp.bookPend)}</div>`:''}
      </div>
    </div>
    ${recs.length?`<div style="font-size:10px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:7px">ì‹ ì²­ ë‚´ì—­</div>
    ${recs.sort((a,b)=>new Date(b.date)-new Date(a.date)).map(r=>`
      <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--border)">
        <div>
          <div style="font-size:12px;font-weight:500">${r.title}</div>
          <div style="font-size:10px;color:var(--text3);margin-top:2px">${r.date} Â· <span class="badge ${r.type==='edu'?'be':'bb'}">${r.type==='edu'?'êµìœ¡':'ë„ì„œ'}</span></div>
        </div>
        <div style="text-align:right;flex-shrink:0;margin-left:10px">
          <div style="font-family:'IBM Plex Mono',monospace;font-size:12px">${fmt(r.amount)}</div>
          <div style="font-size:10px;color:${r.status==='ì™„ë£Œ'?'var(--edu)':'var(--pend)'};margin-top:1px">${r.status==='ì™„ë£Œ'?'ì™„ë£Œ':'â³ ì§„í–‰'}</div>
        </div>
      </div>`).join('')}`
    :'<div style="text-align:center;color:var(--text3);font-size:12px;padding:10px">ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>'}`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ìˆ˜ë™ ì…ë ¥
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openAdd(){
  document.getElementById('fdate').value=new Date().toISOString().split('T')[0];
  document.getElementById('addMod').classList.add('show');
}

function addRecord(){
  const name=document.getElementById('fn').value.trim();
  const dept=document.getElementById('fd').value.trim();
  const empno=document.getElementById('fe').value.trim();
  const type=document.getElementById('ftype').value;
  const amount=parseInt(document.getElementById('famt').value)||0;
  const title=document.getElementById('ftitle').value.trim();
  const date=document.getElementById('fdate').value;
  const status=document.getElementById('fst').value;
  if(!name||!dept||!amount||!title||!date){toast('ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');return;}
  const year=parseInt(date.substring(0,4));
  records.push({id:uid++,name,empno,dept,type,amount,title,date,status,year,_m:true});
  closeM('addMod');
  ['fn','fd','fe','famt','ftitle'].forEach(id=>document.getElementById(id).value='');
  renderAll();
  toast(`${name}ë‹˜ì˜ ë‚´ì—­ì´ ì¶”ê°€ëìŠµë‹ˆë‹¤.`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openXl(){
  document.getElementById('xly').value=String(curYear);
  document.getElementById('xlMod').classList.add('show');
}

function doExcel(){
  const yv=document.getElementById('xly').value;
  const s1=document.getElementById('xs1').checked,s2=document.getElementById('xs2').checked,s3=document.getElementById('xs3').checked;
  const tf=document.getElementById('xlt').value;
  const pendMode=document.getElementById('xlp').value; // 'both' or 'done'
  if(!s1&&!s2&&!s3){toast('ì‹œíŠ¸ë¥¼ í•˜ë‚˜ ì´ìƒ ì„ íƒí•˜ì„¸ìš”.');return;}

  const all=src();
  const years=yv==='all'?[2026,2025,2024]:[parseInt(yv)];
  const yl=yv==='all'?'ì „ì²´':yv+'ë…„';
  const wb=XLSX.utils.book_new();

  const H={font:{bold:true,color:{rgb:'FFFFFF'},sz:11},fill:{patternType:'solid',fgColor:{rgb:'1A2C4E'}},alignment:{horizontal:'center',vertical:'center'},border:{top:{style:'thin',color:{rgb:'4F8CFF'}},bottom:{style:'thin',color:{rgb:'4F8CFF'}},left:{style:'thin',color:{rgb:'4F8CFF'}},right:{style:'thin',color:{rgb:'4F8CFF'}}}};
  const BD={top:{style:'hair',color:{rgb:'D0D7E2'}},bottom:{style:'hair',color:{rgb:'D0D7E2'}},left:{style:'hair',color:{rgb:'D0D7E2'}},right:{style:'hair',color:{rgb:'D0D7E2'}}};
  const C={font:{sz:10},border:BD},N={font:{sz:10},numFmt:'#,##0',alignment:{horizontal:'right'},border:BD},P={font:{sz:10},numFmt:'0%',alignment:{horizontal:'center'},border:BD},Ct={font:{sz:10},alignment:{horizontal:'center'},border:BD};
  function S(ws,r,c,s){const a=XLSX.utils.encode_cell({r,c});if(ws[a])ws[a].s=s;}
  function RS(ws,r,n,s){for(let i=0;i<n;i++)S(ws,r,i,s);}

  if(s1){
    const rows=[];
    years.forEach(yr=>{
      const pv=curYear;curYear=yr;
      getStats().filter(e=>tf==='edu'?e.eduTotal>0:tf==='book'?e.bookTotal>0:true)
        .sort((a,b)=>b.total-a.total)
        .forEach(e=>{
          const useAmt=pendMode==='done'?e.done:e.total;
          const usePct=pendMode==='done'?e.donePct:e.totalPct;
          rows.push([yr,e.empno,e.name,e.dept,e.eduDone,e.bookDone,e.done,
            pendMode==='both'?e.pend:'-',
            pendMode==='both'?e.total:e.done,
            Math.max(0,LIMIT-useAmt),usePct/100,
            usePct>=100?'í•œë„ ì†Œì§„':usePct>=80?'ì£¼ì˜':'ì—¬ìœ ']);
        });
      curYear=pv;
    });
    const pendH=pendMode==='both'?'ì§„í–‰ ì¤‘(ì ì •)':'-';
    const totalH=pendMode==='both'?'ì ì • í•©ê³„':'í™•ì • í•©ê³„';
    const aoa=[
      [`êµìœ¡Â·ë„ì„œë¹„ ì§€ì› í˜„í™© ìš”ì•½ (${yl})${pendMode==='both'?' Â· ì™„ë£Œ+ì§„í–‰ ì ì • í¬í•¨':' Â· ì™„ë£Œë§Œ'}`],
      [`ê¸°ì¤€: ${new Date().toLocaleDateString('ko-KR')} | ì—°ê°„ í•œë„: 500,000ì›`],
      [],
      ['ì—°ë„','ì‚¬ì›ë²ˆí˜¸','ì´ë¦„','ë¶€ì„œ','êµìœ¡ë¹„(í™•ì •)','ë„ì„œë¹„(í™•ì •)','í™•ì • í•©ê³„',pendH,totalH,'ì”ì—¬','ì‚¬ìš©ë¥ ','ìƒíƒœ'],
      ...rows,
      ['','','í•©ê³„','',
        rows.reduce((s,r)=>s+(r[4]||0),0),
        rows.reduce((s,r)=>s+(r[5]||0),0),
        rows.reduce((s,r)=>s+(r[6]||0),0),'','','','','']
    ];
    const ws=XLSX.utils.aoa_to_sheet(aoa);
    ws['!merges']=[{s:{r:0,c:0},e:{r:0,c:11}},{s:{r:1,c:0},e:{r:1,c:11}}];
    S(ws,0,0,{font:{bold:true,sz:13,color:{rgb:'1A2C4E'}},alignment:{horizontal:'center'}});
    S(ws,1,0,{font:{sz:9,color:{rgb:'888888'}},alignment:{horizontal:'center'}});
    RS(ws,3,12,H);
    rows.forEach((_,i)=>{
      const r=i+4;
      [0,1].forEach(c=>S(ws,r,c,Ct));[2,3].forEach(c=>S(ws,r,c,C));
      [4,5,6,7,8,9].forEach(c=>S(ws,r,c,N));S(ws,r,10,P);
      const sc=rows[i][11]==='í•œë„ ì†Œì§„'?'F87171':rows[i][11]==='ì£¼ì˜'?'F59E0B':'34D399';
      S(ws,r,11,{...Ct,font:{bold:true,sz:10,color:{rgb:sc}}});
      if(rows[i][11]==='ì£¼ì˜'||rows[i][11]==='í•œë„ ì†Œì§„'){
        for(let c=0;c<12;c++)S(ws,r,c,{...((ws[XLSX.utils.encode_cell({r,c})]||{}).s||{}),fill:{patternType:'solid',fgColor:{rgb:rows[i][11]==='í•œë„ ì†Œì§„'?'FFF1F1':'FFFBF0'}}});
      }
    });
    ws['!cols']=[6,12,9,16,12,12,12,12,12,11,8,10].map(w=>({wch:w}));
    XLSX.utils.book_append_sheet(wb,ws,'ì§ì›ë³„ ìš”ì•½');
  }

  if(s2){
    const recs=all.filter(r=>(yv==='all'||r.year===parseInt(yv))&&(tf==='all'||r.type===tf)).sort((a,b)=>new Date(b.date)-new Date(a.date));
    const data=recs.map(r=>[r.year,r.date,r.empno,r.name,r.dept,r.type==='edu'?'êµìœ¡ë¹„':'ë„ì„œë¹„',r.title,r.amount,r.status]);
    const aoa=[[`êµìœ¡Â·ë„ì„œë¹„ ì‹ ì²­ ë‚´ì—­ ìƒì„¸ (${yl})`],[`ê¸°ì¤€: ${new Date().toLocaleDateString('ko-KR')}`],[],['ì—°ë„','ê¸°ì•ˆì¼','ì‚¬ì›ë²ˆí˜¸','ì´ë¦„','ë¶€ì„œ','ìœ í˜•','ê³¼ì •ëª…/ë„ì„œëª…','ê¸ˆì•¡','ê²°ì¬ìƒíƒœ'],...data];
    const ws=XLSX.utils.aoa_to_sheet(aoa);
    ws['!merges']=[{s:{r:0,c:0},e:{r:0,c:8}},{s:{r:1,c:0},e:{r:1,c:8}}];
    S(ws,0,0,{font:{bold:true,sz:13,color:{rgb:'1A2C4E'}},alignment:{horizontal:'center'}});
    RS(ws,3,9,H);
    data.forEach((_,i)=>{
      const r=i+4;
      [0,1,2].forEach(c=>S(ws,r,c,Ct));[3,4,6].forEach(c=>S(ws,r,c,C));S(ws,r,7,N);
      const tc=data[i][5]==='êµìœ¡ë¹„'?'34D399':'FB923C';S(ws,r,5,{...Ct,font:{bold:true,sz:10,color:{rgb:tc}}});
      const sc=data[i][8]==='ì™„ë£Œ'?'34D399':data[i][8]==='ë°˜ì†¡'?'F87171':'60A5FA';S(ws,r,8,{...Ct,font:{bold:true,sz:10,color:{rgb:sc}}});
      if(data[i][8]==='ë°˜ì†¡') for(let c=0;c<9;c++)S(ws,r,c,{...((ws[XLSX.utils.encode_cell({r,c})]||{}).s||{}),font:{...((ws[XLSX.utils.encode_cell({r,c})]||{s:{font:{}}}).s.font),color:{rgb:'AAAAAA'}}});
    });
    ws['!cols']=[6,13,11,9,16,9,28,13,9].map(w=>({wch:w}));
    XLSX.utils.book_append_sheet(wb,ws,'ì‹ ì²­ ë‚´ì—­ ìƒì„¸');
  }

  if(s3){
    const rows=[];
    years.forEach(yr=>{
      const pv=curYear;curYear=yr;
      getStats().filter(e=>tf==='edu'?e.eduTotal>0:tf==='book'?e.bookTotal>0:true)
        .sort((a,b)=>(LIMIT-a.total)-(LIMIT-b.total))
        .forEach(e=>{
          const useAmt=pendMode==='done'?e.done:e.total;
          const rem=Math.max(0,LIMIT-useAmt);
          rows.push([yr,e.empno,e.name,e.dept,e.done,e.pend,e.total,rem,e.totalPct/100,
            rem===0?'í•œë„ ì†Œì§„':rem<100000?'ì”ì—¬ 10ë§Œ ì´í•˜':'ì •ìƒ']);
        });
      curYear=pv;
    });
    const aoa=[[`ì”ì—¬ í•œë„ í˜„í™© (${yl})`],[`ê¸°ì¤€: ${new Date().toLocaleDateString('ko-KR')}`],[],['ì—°ë„','ì‚¬ì›ë²ˆí˜¸','ì´ë¦„','ë¶€ì„œ','í™•ì • ì‚¬ìš©ì•¡','ì§„í–‰ ì¤‘','ì ì • í•©ê³„','ì”ì—¬','ì‚¬ìš©ë¥ (ì ì •)','ë¹„ê³ '],...rows];
    const ws=XLSX.utils.aoa_to_sheet(aoa);
    ws['!merges']=[{s:{r:0,c:0},e:{r:0,c:9}},{s:{r:1,c:0},e:{r:1,c:9}}];
    S(ws,0,0,{font:{bold:true,sz:13,color:{rgb:'1A2C4E'}},alignment:{horizontal:'center'}});
    RS(ws,3,10,H);
    rows.forEach((_,i)=>{
      const r=i+4;
      [0,1].forEach(c=>S(ws,r,c,Ct));[2,3].forEach(c=>S(ws,r,c,C));
      [4,5,6].forEach(c=>S(ws,r,c,N));
      const rc=rows[i][7]===0?'F87171':rows[i][7]<100000?'F59E0B':'34D399';
      S(ws,r,7,{...N,font:{bold:true,sz:10,color:{rgb:rc}}});S(ws,r,8,P);
      const nc=rows[i][9]==='í•œë„ ì†Œì§„'?'F87171':rows[i][9]==='ì”ì—¬ 10ë§Œ ì´í•˜'?'F59E0B':'34D399';
      S(ws,r,9,{...Ct,font:{bold:true,sz:10,color:{rgb:nc}}});
    });
    ws['!cols']=[6,11,9,16,12,12,12,11,10,12].map(w=>({wch:w}));
    XLSX.utils.book_append_sheet(wb,ws,'ì”ì—¬ í•œë„ í˜„í™©');
  }

  const fn=`êµìœ¡ë„ì„œë¹„_${yl}_${new Date().toISOString().split('T')[0]}.xlsx`;
  XLSX.writeFile(wb,fn);
  closeM('xlMod');
  toast(`âœ… "${fn}" ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ìœ í‹¸
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchView(v){
  document.getElementById('empTab').classList.toggle('on', v==='emp');
  const at=document.getElementById('adminTab');
  if(at) at.classList.toggle('on', v==='admin');
  document.getElementById('adminView').style.display=v==='admin'?'':'none';
  document.getElementById('empView').style.display=v==='emp'?'block':'none';
  if(v==='emp') populateDepts();
}

let isAdmin = false;

function toggleAdmin(){
  if(isAdmin){
    // ì´ë¯¸ ê´€ë¦¬ì ìƒíƒœë©´ ë¡œê·¸ì•„ì›ƒ
    isAdmin = false;
    document.getElementById('adminTab').style.display='none';
    document.getElementById('lockBtn').textContent='ğŸ”’';
    document.getElementById('lockBtn').title='ê´€ë¦¬ì ë¡œê·¸ì¸';
    switchView('emp');
    toast('ê´€ë¦¬ì ëª¨ë“œ ì¢…ë£Œ');
  } else {
    // ë¡œê·¸ì¸ ëª¨ë‹¬ ì—´ê¸°
    document.getElementById('adminPw').value='';
    document.getElementById('adminPwErr').style.display='none';
    document.getElementById('adminLoginMod').classList.add('show');
    setTimeout(()=>document.getElementById('adminPw').focus(), 100);
  }
}

function checkAdmin(){
  const pw = document.getElementById('adminPw').value;
  if(pw === '920824'){
    isAdmin = true;
    closeM('adminLoginMod');
    document.getElementById('adminTab').style.display='';
    document.getElementById('lockBtn').textContent='ğŸ”“';
    document.getElementById('lockBtn').title='ê´€ë¦¬ì ëª¨ë“œ ì¢…ë£Œ';
    switchView('admin');
    toast('âœ… ê´€ë¦¬ì ëª¨ë“œ í™œì„±í™”');
  } else {
    document.getElementById('adminPwErr').style.display='block';
    document.getElementById('adminPw').value='';
    document.getElementById('adminPw').focus();
  }
}

function onYearChange(){
  curYear=parseInt(document.getElementById('ySel').value);
  document.getElementById('detSec').style.display='none';
  document.getElementById('listSec').style.display='block';
  renderAll();
}

function closeM(id){document.getElementById(id).classList.remove('show');}

function toast(msg){
  const t=document.getElementById('toast');
  t.textContent=msg;t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),3500);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ì´ˆê¸°í™”
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded',()=>{
  curYear=parseInt(document.getElementById('ySel').value);
  renderAll();
  // ê¸°ë³¸: ì§ì› ì¡°íšŒ íƒ­ìœ¼ë¡œ ì‹œì‘
  switchView('emp');
  // êµ¬ê¸€ ì‹œíŠ¸ ìë™ ë¶ˆëŸ¬ì˜¤ê¸°
  loadSheets();
});
</script>
</body>
</html>
